<!DOCTYPE html>
<html lang="ES">
  <head>
      <title>Armaf Delights Island Bliss agua de perfume para mujeres 100 ml | Ferwer</title>
      <meta charset="utf-8">
    <meta name="description" content="Armaf Delights Island Bliss agua de perfume para mujeres 100 ml">
          <meta name="keywords" content="armaf,delights,island,bliss,agua,de,perfume,para,mujeres,100,ml">
          <meta name="robots" content="index,follow">
<meta name="ahrefs-site-verification" content="0b3956eb4619e7835a48a06c3a4fa04dca4800667070e5599f903a9a485a38cf">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://www.ferwer.es/armaf-delights-island-bliss-agua-de-perfume-para-mujeres">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120-precomposed.png">
    <link rel="apple-touch-icon" sizes="160x160" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" color="#fe6a6a" href="/safari-pinned-tab.svg">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <meta name="google" content="notranslate">
    <meta name="author" content="Ferwer">
    <meta name="p:domain_verify" content="48bb989765e3f556028baf74539b03b7">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://c.imedia.cz">
    <link rel="preconnect" href="https://c.seznam.cz">
    <link rel="preconnect" href="https://www.google-analytics.com">

<link rel="stylesheet" media="screen" href="/vendor/drift-zoom/dist/drift-basic.min.css">
<link rel="stylesheet" media="screen" href="/vendor/lightgallery.js/dist/css/lightgallery.min.css"><link rel="stylesheet" media="screen" href="/css/col-xs.css?v=4">
<link rel="stylesheet" media="screen" href="/vendor/tiny-slider/dist/tiny-slider.css">
<link rel="stylesheet" media="screen" href="/css/theme_min_ext.css">
<link rel="stylesheet" media="screen" href="/css/custom.css?v=4">
<link rel="stylesheet" media="screen" href="/css/newmenu.css?v=4">
<link rel="stylesheet" href="/fontawesome/css/all.css">
<link rel="stylesheet" media="screen" href="/vendor/simplebar/dist/simplebar.min.css">

<link rel="alternate" hreflang="x-default" href="https://www.ferwer.cz/armaf_armaf-delights-island-bliss-parfemovana-voda-pro-zeny-100-ml">
<link rel="alternate" hreflang="cs" href="https://www.ferwer.cz/armaf_armaf-delights-island-bliss-parfemovana-voda-pro-zeny-100-ml">
<link rel="alternate" hreflang="de" href="https://www.ferwer.de/armaf-delights-island-bliss-eau-de-parfum-fur-frauen">
<link rel="alternate" hreflang="de-at" href="https://www.ferwer.at/armaf-delights-island-bliss-eau-de-parfum-fur-frauen">
<link rel="alternate" hreflang="en-gb" href="https://www.ferwer.com/armaf-delights-island-bliss-eau-de-parfum-for-women">
<link rel="alternate" hreflang="es" href="https://www.ferwer.es/armaf-delights-island-bliss-agua-de-perfume-para-mujeres">
<link rel="alternate" hreflang="fr" href="https://www.ferwer.fr/armaf-delights-island-bliss-eau-de-parfum-pour-femmes">
<link rel="alternate" hreflang="fr-be" href="https://www.ferwer.be/armaf-delights-island-bliss-eau-de-parfum-pour-femmes">
<link rel="alternate" hreflang="it" href="https://www.ferwer.it/armaf-delights-island-bliss-eau-de-parfum-per-donne">
<link rel="alternate" hreflang="hu" href="https://www.ferwer.hu/armaf-delights-island-bliss-parfum-noknek">
<link rel="alternate" hreflang="nl" href="https://www.ferwer.nl/armaf-delights-island-bliss-eau-de-parfum-voor-vrouwen">
<link rel="alternate" hreflang="sk" href="https://www.ferwer.sk/armaf-delights-island-bliss-parfumovana-voda-pre-zeny">
<link rel="alternate" hreflang="pt-pt" href="https://www.ferwer.pt/armaf-delights-island-bliss-eau-de-parfum-para-mulheres">
<link rel="alternate" hreflang="sl" href="https://www.ferwer.si/armaf-delights-island-bliss-parfumska-voda-za-zenske">
<link rel="alternate" hreflang="da" href="https://www.ferwer.dk/armaf-delights-island-bliss-parfumeret-vand-til-kvinder">
<link rel="alternate" hreflang="pl" href="https://www.ferwer.pl/armaf-delights-island-bliss-woda-perfumowana-dla-kobiet">
<style>
@media (max-width: 400px) {
          .menu-text {
            display: none;
          }
        }
        
.fliper_image {
    left:0;
    position:absolute;
    right:0;
    top:0;
    opacity:0;
    margin-left: auto;
    margin-right: auto;
}
.product-card:hover .fliper_image{
    opacity:1;
    filter:alpha(opacity=100);
    background-color: white;
}
.autocomplete {
  /*the container must be positioned relative:*/
  position: relative;
  display: inline-block;
}
.autocomplete-items {
  font-size: 13px!important;
  position: absolute;
  border: 1px solid #CCCCCC;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}
.autocomplete-items div {
  padding: 5px;
  cursor: pointer;
  background-color: #FFFFFF;
  border-bottom: 1px solid #CCCCCC;
}
.autocomplete-items div:hover {
  /*when hovering an item:*/
  background-color: #FFFFFF;
}
.autocomplete-active {
  /*when navigating through the items using the arrow keys:*/
  background-color: DodgerBlue !important;
  color: #ffffff;
}

@media (min-width: 993px) {
  .mh {
    display: none!important;
  }
  .ms {
    display: inherit!important;
  }
  .searchform {
     width: 50%!important;
  }
}
@media (max-width: 992px) {
  .mh {
    display: inherit!important;
  }
  .ms {
    display: none!important;
  }
  .searchform {
     width: 1px!important;
  }
  .menu_images {
   display: none!important;
  }
}

@media (max-width: 332px) {
  .topbar-text {
    font-size:  12px;
  }
}

@media (max-width: 992px) {
  .pipe {
    display:  none;
  }
}

@media (min-width: 992px) {
  .ekomenu {
    width: 800px;
  }
}

@media (min-width: 1100px) and (max-width: 1250px) {
  .navbar-nav {
    font-size: 14px!important;
  }
}

@media (max-width: 1099px) {
  .navbar-nav {
    font-size: 12px;
  }
}

@media screen and (max-width: 767px) {
    #header_desktop, #header_desktop2 {
        display: none;
    }
}
</style>

<script src="/js/lazysizes.min.js" async></script>


<script src="/js/jquery-3.6.0.min.js" ></script><script>
document.addEventListener("DOMContentLoaded", function(event) {
  pixels = window.innerWidth;
  if(pixels>992) {
    var a = document.getElementById('ekobutton'); //or grab it by tagname etc
    //a.href = "/farmacia-ecologica?full=1";
  }
});

function n(url) {
    if(url) document.location.href=url;
}
</script>


<script>
window.dataLayer = window.dataLayer || [];
function gtag(){
  dataLayer.push(arguments);
}
gtag('consent', 'default', {
  'ad_storage': 'denied',
  'ad_user_data': 'denied',
  'ad_personalization': 'denied',
  'analytics_storage': 'denied'
});
</script>

<script type="text/javascript" src="//www.termsfeed.com/public/cookie-consent/4.1.0/cookie-consent.js" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({"notice_banner_type":"simple","consent_type":"express","palette":"light","language":"es","page_load_consent_levels":["strictly-necessary"],"notice_banner_reject_button_hide":true,"preferences_center_close_button_hide":false,"page_refresh_confirmation_buttons":false,"website_name":"Ferwer.es","domain":"ferwer.es",
  "callbacks": {
    "scripts_specific_loaded": (level) => {
      switch(level) {
        case 'targeting':
          gtag('consent', 'update', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
          });
          break;
      }
    }
  },
  "callbacks_force": true
});
});
</script>
<script type="text/plain" data-cookie-consent="targeting" async src="https://www.googletagmanager.com/gtag/js?id=UA-122471947-7" data-keepinline></script>
<script type="text/plain" data-cookie-consent="targeting" data-keepinline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-122471947-7');
    gtag('config', 'AW-962419550', { ' allow_enhanced_conversions':true } ) ;
  gtag('event', 'page_view', {'send_to': 'AW-962419550',
   'ecomm_prodid': 11189,
   'ecomm_pagetype': 'product'
   , 'ecomm_totalvalue': 780.00   ,'ecomm_currency': '€'
   , 'ecomm_category': 'Novinky'
   , 'isSaleItem': false
   , 'isNewItem': false
   });
   
    
</script>


<!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '269329529172768');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none" alt="facebook" src="https://www.facebook.com/tr?id=269329529172768&ev=PageView&noscript=1"></noscript>
<!-- End Meta Pixel Code -->
  </head>
  <!-- Body-->
  <body>




    <main class="page-wrapper">
      <!-- Navbar 3 Level (Light)-->
      <header class="shadow-sm">
        <!-- Topbar-->


        <div class="topbar topbar-dark bg-dark" style="background-color:#469759!important;">
          <div class="container" style="display:block!important;text-align:center!important;background-color:#469759;">
              <div class="topbar-text" style="color:white!important;"><span id="header_desktop">Los pedidos realizados antes de las 12:00 horas se envían inmediatamente | </span>Envío gratis en pedidos superiores a 95 EUR<span id="header_desktop2"> | Cambios y devoluciones gratuitos dentro de los 90 días</span></div>
          </div>
        </div>




        <!--</div>-->
        <!-- Remove "navbar-sticky" class to make navigation bar scrollable with the page.-->
        <div class="bg-light">
          <div class="navbar navbar-expand-lg navbar-light">
            <div class="container" id="fwlogoc"><a class="navbar-brand d-none d-sm-block flex-shrink-0" href="/"><img src="/img/ferwer-logo.webp" width="142" height="42" alt="Armaf Delights Island Bliss agua de perfume para mujeres 100 ml | Ferwer"></a><a class="navbar-brand d-sm-none flex-shrink-0 me-2" href="/"><img src="/img/ferwer-logo.webp" width="87" height="25" alt="Armaf Delights Island Bliss agua de perfume para mujeres 100 ml | Ferwer"></a>
              <form autocomplete="off" action="/search?term=" class="searchform">

              <div class="input-group d-none d-lg-flex mx-4 autocomplete" style=padding-top:15px>
                                  <input name="searchbox" class="form-control rounded-end pe-5" id="searchbox" type="text" placeholder="Buscar una marca, categoría o producto"><i class="ci-search position-absolute end-0 translate-middle-y text-muted fs-base me-3" style="top:60%"></i>
              </div>
              <input type="submit" style="visibility: hidden;height:1px;">

              </form>
              <div class="navbar-toolbar d-flex flex-shrink-0 align-items-center">

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"><span style="padding-right:10px" class="menu-text">Menú</span><span class="navbar-toggler-icon"></span></button>
                  
                <button class="navbar-toggler mobile-search-trigger-header" type="button"><i class="ci-search"></i></button>
                
                                    <a class="navbar-tool ms-1 ms-lg-0 me-n1 me-lg-2" href="#signin-modal" data-bs-toggle="modal">
                                    <div class="navbar-tool-icon-box"><i class="navbar-tool-icon ci-user"></i></div>
                                    <div class="navbar-tool-text ms-n3"><small>Iniciar sesión</small>Mi cuenta</div>
                                    </a>

                <div class="navbar-tool dropdown ms-3"><a class="navbar-tool-icon-box bg-secondary dropdown-toggle" href="/cart"><span class="navbar-tool-label" id="cart_pieces">0</span><i class="navbar-tool-icon ci-cart"></i></a><a class="navbar-tool-text" href="/cart"><small>Cesta</small><span id=cart_total></span></a>
                  <!-- Cart dropdown-->
                </div>
              </div>
            </div>
          </div>
                        <div class="navbar navbar-expand-lg navbar-light navbar-stuck-menu mt-n2 pt-0">
                <div class="container">
                    <div class="collapse navbar-collapse justify-content-md-between">

                        <ul class="navbar-nav pe-lg-2 topsimplemenu">

                            <li class="nav-item"><a class="nav-link" href="/slevy" style="font-weight:normal;color:red">
                                    <i class="fas ci-percent" style="font-weight:normal;color:red;padding-right:3px"></i> Descuentos hasta -80%</a></li>


                            
                                                        <li class="nav-item"><a class="nav-link" href="/blog"><i class="fas fa-book" style="padding-right:3px;"></i> Blog</a></li>
                            
                            <li class="nav-item"><a class="nav-link" href="/lexico"><i class="fas fa-book-medical" style="padding-right:3px"></i> Léxico</a></li>

                        </ul>

                        <ul class="navbar-nav topsimplemenu2">

                                                                                    <li class="nav-item"><a class="nav-link" href="/contacte-con"><i class="fas fa-phone" style="font-size: 13px;padding-right:3px;"></i> Contacte con</a></li>
                        </ul>


                    </div>
                </div>

            </div>
            

          <div class="navbar navbar-expand-lg navbar-light navbar-stuck-menu mt-n2 pt-0 topgreenmenu"  style="">
            <div class="container" id="navbarCollapseWrapper">
              <div class="collapse navbar-collapse justify-content-md-start" id="navbarCollapse" style="width:100%;position:relative">
                <!-- Mobile padding replacement for hidden search -->
                <div class="d-lg-none" style="height: 1.5rem;"></div>

<form autocomplete="off" action="/search?term=" style="display: none;">
                <div class="input-group d-lg-none my-3"><i class="ci-search position-absolute top-50 start-0 translate-middle-y text-muted fs-base ms-3"></i>
                  <input name="searchbox" class="form-control rounded-start" type="text" placeholder="Buscar productos, marcas..." id="searchbox_mobile">
                </div>
</form>


<ul class="navbar-nav pe-lg-2 ">
    <li class="nav-item dropdown dropdown-center" id="ekomenu_dropdown">
        <a id="ekobutton" class="nav-link dropdown-toggle ps-lg-0 mh" data-bs-toggle="dropdown" style="cursor:pointer"><i class="fas fa-air-freshener"></i> Eko Droguería</a>
        <a id="ekobutton2" class="nav-link dropdown-toggle ps-lg-0 ms" style="cursor:pointer"><i class="fas fa-air-freshener"></i> Eko Droguería</a>
        <div class="dropdown-menu px-4 pb-6 ekomenu menu2">
            <div class="row">
                <div class="col-md-9" style="">
                    <div class="row" id="ed_content"></div>
                </div>
                <div class="col-md-3" style="border-left: 1px #EEEEEE solid" id="ed_vendors"></div>
            </div>
        </div>
    </li>
</ul><ul class="navbar-nav pe-lg-2 me-lg-2">
    <li class="nav-item dropdown dropdown-center" style="position: relative">
        <a class="nav-link dropdown-toggle ps-lg-0 mh" id="shoesbutton" data-bs-toggle="dropdown" style="cursor:pointer"><i class="fas fa-shoe-prints"></i> Zapatos ECO</a>
        <a class="nav-link dropdown-toggle ps-lg-0 ms" id="shoesbutton2" style="cursor:pointer"><i class="fas fa-shoe-prints"></i> Zapatos ECO</a>
        <div class="dropdown-menu px-2 pb-4 menu2 shoes">
            <div class="row">
                <div class="col-md-9" style="">
                    <div class="row" id="shoes_content"></div>
                </div>
                <div class="col-md-3" style="border-left: 1px #EEEEEE solid" id="shoes_vendors"></div>
            </div>
        </div>
    </li>
</ul>
<ul class="navbar-nav pe-lg-2 ">
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle ps-lg-0 mh" id="clothesbutton" data-bs-toggle="dropdown" style="cursor:pointer"><i class="fas fa-tshirt"></i> Ropa ECO</a>
        <a class="nav-link dropdown-toggle ps-lg-0 ms" id="clothesbutton2" style="cursor:pointer"><i class="fas fa-tshirt"></i> Ropa ECO</a>
        <div class="dropdown-menu px-2 pb-4 menu2">

            <div class="row">
                <div class="col-md-9" style="">
                    <div class="row" id="clothes_content"></div>
                </div>
                <div class="col-md-3" style="border-left: 1px #EEEEEE solid" id="clothes_vendors"></div>
            </div>

        </div>
    </li>
</ul>
<ul class="navbar-nav pe-lg-2 ">
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle ps-lg-0 mh" id="accbutton" data-bs-toggle="dropdown" style="cursor:pointer"><i class="fas fa-socks"></i> Accesorios ECO</a>
        <a class="nav-link dropdown-toggle ps-lg-0 ms" id="accbutton2" style="cursor:pointer"><i class="fas fa-socks"></i> Accesorios ECO</a>
        <div class="dropdown-menu px-2 pb-4 menu2">

            <div class="row">
                <div class="col-md-9" style="">
                    <div class="row" id="acc_content"></div>
                </div>
                <div class="col-md-3" style="border-left: 1px #EEEEEE solid" id="acc_vendors"></div>
            </div>

        </div>
    </li>
</ul>
<ul class="navbar-nav pe-lg-2 ">
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle ps-lg-0 mh" id="perfbutton" data-bs-toggle="dropdown" style="cursor:pointer"><i class="fas fa-air-freshener"></i> Perfumes</a>
        <a class="nav-link dropdown-toggle ps-lg-0 ms" id="perfbutton2" style="cursor:pointer"><i class="fas fa-air-freshener"></i> Perfumes</a>
        <div class="dropdown-menu px-2 pb-4 menu2">

            <div class="row">
                <div class="col-md-6" style="">
                    <div class="row" id="perf_content"></div>
                </div>
                <div class="col-md-6" style="border-left: 1px #EEEEEE solid" id="perf_vendors"></div>
            </div>

        </div>
    </li>
</ul>


<ul class="navbar-nav pe-lg-2" style="padding-bottom:0px;">

    <li class="nav-item d-none d-lg-block" style="margin-right:12px;"><a class="nav-link" style="padding-left:0px;padding-right:0px;"><span style="font-weight: normal;color:#ffffff" class="pipe">| </span></a></li>

    <li class="nav-item d-lg-none">
        <a class="nav-link" href="/slevy">
            <span style="display:inline-flex;align-items:center;gap:8px;background:#ffffff;border:1px solid #fe696a;color:#fe696a;padding:6px 12px;border-radius:999px;font-weight:700;box-shadow:0 1px 2px rgba(0,0,0,0.06);">
                <i class="fas fa-percent" style="color:#fe696a!important"></i>
                <span style="color:#fe696a">Descuentos hasta -80%</span>
            </span>
        </a>
    </li>

    
    <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside"><i class="fas fa-file-alt">&nbsp;</i>Todo sobre la compra</a>
        <ul class="dropdown-menu">
                        <li><a class="dropdown-item ct" href="/transporte-y-pago">Transporte y pago</a></li><li><a class="dropdown-item ct" href="/cambios-devoluciones-y-reclamaciones">Cambios, devoluciones y reclamaciones</a></li><li><a class="dropdown-item ct" href="/programa-de-fidelidad">Programa de fidelidad</a></li><li><a class="dropdown-item ct" href="/contacte-con">Contacte con</a></li><li><a class="dropdown-item ct" href="/terminos-y-condiciones">Términos y condiciones</a></li><li><a class="dropdown-item ct" href="/sobre-nosotros">Quiénes somos</a></li><li><a class="dropdown-item ct" href="/como-medir-la-longitud-del-pie">Cómo medir la longitud del pie</a></li>        </ul>
    </li>

    
</ul>

<script>
    function fix_top_menu() {

        var pos = $('#navbarCollapse').position();
        var ncl = pos.left;

        var w = ($('#navbarCollapse').width()/100)*90;
        var dw = $('#navbarCollapse').width();

        var extra = 0;
        var uleft = 0;

        var l = 0;

        $(".menu2").each(function() {

            if(dw>=1400) {
                w = 1260;
                extra = 10;
                uleft = $(this).closest('ul').position().left;
            }

            if(w<1400) {
                w = $(document).width()-$(window).scrollLeft();
                w = 1260;
                extra = 15;
                uleft = $(this).closest('ul').position().left;
            }

            //console.log(uleft);
            //l = Math.round(((dw-w)/2) - uleft + $(window).scrollLeft() + extra);
            l = Math.round(((dw-w)/2) - uleft + $(window).scrollLeft() + extra);
            if(w>768) {
                //l = 0;
                $(this).attr('style', 'width: ' + w + 'px; left: '+ l +'px !important');
            }

        });

    }
    fix_top_menu();

    $(document).ready(function() {
        fix_top_menu();
        $( window ).resize(function() {
            fix_top_menu();
        });
        /*$('.dropdown-toggle').on('hover', function() {
        });*/
    });
</script>


<script>
    // menu-cs_cs
    var rendered = [];
    var fw_menu = [];
    var menu_loaded = false;

    function get_menu(repeat=0) {
        var xhr = new XMLHttpRequest();
        var suffix = '';
        if(repeat>0) suffix = (Date.now() % 1000) / 1000;
        if(repeat>3) return;
        xhr.open('GET', '/cache/menu-es_es.json?t=4' + suffix, false);
        xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 300) {
                fw_menu = JSON.parse(xhr.responseText);
                //console.log(fw_menu);
                menu_loaded = true;
                //console.log("Initial menu load completed");
            } else {
                console.error('The request failed!');
                setTimeout(() => {
                    get_menu(repeat+1);
                }, "1000");


            }
        };
        xhr.onerror = function () {
            console.error('Network error');
        };
        xhr.send();
    }

    function render_menu(obj, items, toplink='', include_more=false, cols=4, force_dynamic_more=false) {
        var top_url = items['url'];
        var i = 1;
        var more = false;
        console.log("obj: " + obj);
        Object.keys(items).forEach(function(key) {
            var value = items[key];
            var box = value;
            var li = '';
            if(force_dynamic_more) include_more = false;
            console.log(Object.keys(box['items']).length);
            if(parseInt(Object.keys(box['items']).length)>4 && force_dynamic_more) {
                console.log("force more = true FOR " + obj);
                include_more = true;
            }

            for (let i = 0, keys = Object.keys(box['items']), len = keys.length; i < len; i++) {
                let key = keys[i];
                let value = box['items'][key];
                li += `<li class="widget-list-item"><a class="widget-list-link ct" href="/${value['url']}">${value['title']}</a></li>`;

                if (i === 3 && include_more) {
                    li += `<li class="widget-list-item"><a class="widget-list-link ct" href="/${box['url']}"><small class="text-bold">otras categorías</small></a></li>`;
                    break;
                }
            }

            var html = '<div class="col-12 col-md-' + cols + '">'
                + '<div class="menu-card">'
                +     '<div class="row d-none d-md-flex">'
                +         '<div class="col-sm-3 col-md-3 mt-4 pr-0 menu-img-col">'
                +             '<a href="/' + box['url'] + '"><img src="' + box['image'] + '" class="img-thumbnail2 rounded-circle align-left" alt="' + box['title'] + '"></a>'
                +         '</div>'
                +         '<div class="col-sm-9 col-md-9 mt-4">'
                +             '<a href="/' + box['url'] + '"><h6 class="fs-base mb-3 menu-section-title ct">' + box['title'] + '</h6></a>'
                +             '<ul class="widget-list">' + li + '</ul>'
                +         '</div>'
                +     '</div>'
                +     '<div class="row align-items-center menu-header d-md-none">'
                +         '<div class="col-2 pr-0 menu-img-col">'
                +             '<a href="/' + box['url'] + '"><img src="' + box['image'] + '" class="img-thumbnail2 rounded-circle align-left" alt="' + box['title'] + '"></a>'
                +         '</div>'
                +         '<div class="col-10 menu-content-col">'
                +             '<a href="/' + box['url'] + '"><h6 class="fs-base mb-3 menu-section-title ct">' + box['title'] + '</h6></a>'
                +         '</div>'
                +     '</div>'
                +     '<div class="row d-md-none">'
                +         '<div class="col-12">'
                +             '<ul class="widget-list">' + li + '</ul>'
                +         '</div>'
                +     '</div>'
                + '</div>'
                + '</div>';

            let parent = document.getElementById(obj);
            parent.insertAdjacentHTML('beforeend', html);
            rendered[obj] = true;
        });
    }

    function render_vendors(obj, vendors, cols_=6) {
        var vendorItems = [];
        Object.keys(vendors).forEach(function(key) {
            var vendor = vendors[key];
            if (vendor['url'] && vendor['title']) {
                vendorItems.push(vendor);
            }
        });

        // Značky jsou již seřazeny podle prodejů z SQL dotazu - zachováme pořadí

        // Vypočítat počet sloupců
        var numCols = Math.floor(12 / cols_);
        // Vypočítat počet položek na sloupec (zaokrouhleno nahoru)
        var itemsPerCol = Math.ceil(vendorItems.length / numCols);
        
        // Rozdělit značky do sloupců pro vertikální řazení
        var columns = [];
        for (var i = 0; i < numCols; i++) {
            columns[i] = [];
        }
        
        // Naplnit sloupce vertikálně (shora dolů)
        for (var i = 0; i < vendorItems.length; i++) {
            var colIndex = Math.floor(i / itemsPerCol);
            columns[colIndex].push(vendorItems[i]);
        }
        
        // Vykreslení sloupců
        var cols = '';
        for (var colIndex = 0; colIndex < numCols; colIndex++) {
            if (columns[colIndex].length > 0) {
                cols += '<div class="col-6 col-md-' + cols_ + '">';
                columns[colIndex].forEach(function(vendor) {
                    cols += '<a class="widget-list-link ct d-block" href="/' + vendor['url'] + '">' + vendor['title'] + '</a>';
                });
                cols += '</div>';
            }
        }

        if (obj == 'perf_vendors') cols += '<div class="col-12 col-md-12 mt-3"><a href="/marcas-de-perfumes" class="widget-list-link ct">Todas las marcas</a></div>';

        var html = '<h6 class="fs-base mb-3 mt-4 menu-section-title">Marcas favoritas</h6>'
            + '<div class="row">'
            + cols
            + '</div>';
        let parent = document.getElementById(obj);
        parent.insertAdjacentHTML('beforeend', html);
        rendered[obj] = true;
    }

    function render_eco(key, value) {
        //var startTime = performance.now();
        if(key=="box") {
            obj = 'ed_content';
            if(rendered[obj] == true) return;
            render_menu(obj, value, '', false, 4, true);
        }
        if(key=="vendors") {
            obj = 'ed_vendors';
            if(rendered[obj] == true) return;
            render_vendors(obj, value);
        }
        //var endTime = performance.now();
        //console.log("ecod menu render time: " + (endTime-startTime) + 'ms')
    }

    function render_shoes(key, value) {
        //var startTime = performance.now();
        if(!menu_loaded) get_menu();
        if(key=="box") {
            obj = 'shoes_content';
            if(rendered[obj] == true) return;
            render_menu(obj, value);
        }
        if(key=="vendors") {
            obj = 'shoes_vendors';
            if(rendered[obj] == true) return;
            render_vendors(obj, value);
        }
        //var endTime = performance.now();
        //console.log("shoes menu render time: " + (endTime-startTime) + 'ms')
    }

    function render_clothes(key, value) {
        //var startTime = performance.now();
        if(!menu_loaded) get_menu();
        if(key=="box") {
            obj = 'clothes_content';
            if(rendered[obj] == true) return;
            render_menu(obj, value);
        }
        if(key=="vendors") {
            obj = 'clothes_vendors';
            if(rendered[obj] == true) return;
            render_vendors(obj, value);
        }
        //var endTime = performance.now();
        //console.log("clothes menu render time: " + (endTime-startTime) + 'ms')
    }

    function render_acc(key, value) {
        //var startTime = performance.now();
        if(!menu_loaded) get_menu();
        if(key=="box") {
            obj = 'acc_content';
            if(rendered[obj] == true) return;
            //render_menu(obj, value);
            render_menu(obj, value, '', false, 4, false);
        }
        if(key=="vendors") {
            obj = 'acc_vendors';
            if(rendered[obj] == true) return;
            render_vendors(obj, value);
        }
        //var endTime = performance.now();
        //console.log("clothes menu render time: " + (endTime-startTime) + 'ms')
    }

    function render_biof(key, value) {
        //var startTime = performance.now();
        if(!menu_loaded) get_menu();
        if(key=="box") {
            obj = 'biof_content';
            if(rendered[obj] == true) return;
            render_menu(obj, value, '', false, 6, true);
        }
        if(key=="vendors") {
            obj = 'biof_vendors';
            if(rendered[obj] == true) return;
            render_vendors(obj, value, 4);
        }
        //var endTime = performance.now();
        //console.log("bio food menu render time: " + (endTime-startTime) + 'ms')
    }

    function render_perf(key, value) {
        //var startTime = performance.now();
        if(!menu_loaded) get_menu();
        if(key=="box") {
            obj = 'perf_content';
            if(rendered[obj] == true) return;
            render_menu(obj, value, '', false, 6, false);
        }
        if(key=="vendors") {
            obj = 'perf_vendors';
            if(rendered[obj] == true) return;
            render_vendors(obj, value, 4);
        }
        //var endTime = performance.now();
        //console.log("bio food menu render time: " + (endTime-startTime) + 'ms')
    }

    document.getElementById("ekobutton").addEventListener("click", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['ecod']).forEach(function(key) {
            render_eco(key, fw_menu['ecod'][key]);
        });
    });
    document.getElementById("ekobutton2").addEventListener("mouseover", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['ecod']).forEach(function(key) {
            render_eco(key, fw_menu['ecod'][key]);
        });
    });

    document.getElementById("shoesbutton").addEventListener("click", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['shoes']).forEach(function(key) {
            render_shoes(key, fw_menu['shoes'][key]);
        });
    });
    document.getElementById("shoesbutton2").addEventListener("mouseover", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['shoes']).forEach(function(key) {
            render_shoes(key, fw_menu['shoes'][key]);
        });
    });

    document.getElementById("clothesbutton").addEventListener("click", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['clothes']).forEach(function(key) {
            render_clothes(key, fw_menu['clothes'][key]);
        });
    });
    document.getElementById("clothesbutton2").addEventListener("mouseover", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['clothes']).forEach(function(key) {
            render_clothes(key, fw_menu['clothes'][key]);
        });
    });

    document.getElementById("accbutton").addEventListener("click", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['acc']).forEach(function(key) {
            render_acc(key, fw_menu['acc'][key]);
        });
    });
    document.getElementById("accbutton2").addEventListener("mouseover", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['acc']).forEach(function(key) {
            render_acc(key, fw_menu['acc'][key]);
        });
    });

    
    document.getElementById("perfbutton").addEventListener("click", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['perf']).forEach(function(key) {
            render_perf(key, fw_menu['perf'][key]);
        });
    });
    document.getElementById("perfbutton2").addEventListener("mouseover", function(){
        if(!menu_loaded) get_menu();
        Object.keys(fw_menu['perf']).forEach(function(key) {
            render_perf(key, fw_menu['perf'][key]);
        });
    });

</script>
              </div>
            </div>
          </div>
        </div>


      </header>
      <style>
        .detail-top-spacer { padding-top: 30px !important; }
        @media (min-width: 993px) {
          .detail-top-spacer { padding-top: 0px !important; }
        }
        .api_product_title .share-wrapper { margin-left: 8px; }
      </style>
      <!-- Page Title-->
      <div>
        <div class="container d-lg-flex justify-content-between py-1 py-lg-3 detail-top-spacer">
          <div class="mb-3 mb-lg-0 pt-lg-2">

            <!--<nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-light flex-lg-nowrap justify-content-center justify-content-lg-start" style="padding-top:10px">

               <li class="breadcrumb-item"><a class="text-nowrap" href="/"><i class="ci-home"></i></a></li>-->


              <!--<li class="breadcrumb-item breadcrumb-product">Armaf Delights Island Bliss agua de perfume para mujeres 100 ml</li>
              </ol>
            </nav>-->



                                <style>
                      .scroll-container {
                          width: 100%;
                          max-width:1200px;
                          height: 50px;
                          overflow-x: auto;
                          white-space: nowrap;
                          border: 0px;
                          background: white;
                          color: white;
                          /* Skryje scrollbar v moderních prohlížečích */
                          scrollbar-width: none;
                          scrollbar-color: transparent transparent;
                          background-color: #469759;
                      }

                      /* Pro Webkit prohlížeče (Chrome, Safari, Edge) */
                      .scroll-container::-webkit-scrollbar {
                          width: 4px;
                          height: 4px;
                      }

                      .scroll-container::-webkit-scrollbar-track {
                          background: transparent;
                      }

                      .scroll-container::-webkit-scrollbar-thumb {
                          background: transparent;
                      }

                      /* Zobrazí scrollbar při interakci */
                      .scroll-container:hover::-webkit-scrollbar-thumb,
                      .scroll-container:active::-webkit-scrollbar-thumb {
                          background: rgba(0, 0, 0, 0.2);
                          border-radius: 2px;
                      }

                      .scroll-container:hover,
                      .scroll-container:active {
                          scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
                      }

                      .scroll-text {
                          padding: 4px 8px;
                          margin: 0;
                      }
                  </style>

                  <div style="display: flex; justify-content: center; align-items: center; height: 35px;">
                          <p style="margin: 0; padding: 8px;"><a class="text-nowrap" href="/"><i class="ci-home" style="font-size:13px;color:var(--bs-body-color);"></i></a> <i class="ci-arrow-right" style="font-size:13px;"></i> <a href="/perfumes" style="font-size:13px;color:var(--bs-body-color);">Perfumes</a> <i class="ci-arrow-right" style="font-size:13px;"></i> <a href="/perfumes-para-mujer" style="font-size:13px;color:var(--bs-body-color);">Perfumes para mujer</a> <i class="ci-arrow-right" style="font-size:13px;"></i> <a href="/aguas-perfumadas" style="font-size:13px;color:var(--bs-body-color);">Aguas perfumadas</a> <i class="ci-arrow-right" style="color:var(--bs-body-color);font-size:13px;"></i> <span style="font-size:13px;color:var(--bs-body-color)">Armaf Delights Island Bliss agua de perfume para mujeres 100 ml</span></p>
                  </div>


                  


              <script type="application/ld+json">
							{
							"@context": "http://schema.org",
							"@type": "BreadcrumbList",
							"itemListElement": [
				{
				"@type": "ListItem",
				"position": 1,
				"item": {
					"@id": "https://www.ferwer.es/perfumes",
					"name": "Perfumes"
					}
				},{
				"@type": "ListItem",
				"position": 2,
				"item": {
					"@id": "https://www.ferwer.es/perfumes-para-mujer",
					"name": "Perfumes para mujer"
					}
				},{
				"@type": "ListItem",
				"position": 3,
				"item": {
					"@id": "https://www.ferwer.es/aguas-perfumadas",
					"name": "Aguas perfumadas"
					}
				}]}</script>          </div>
        </div>
      </div>
      <div class="container">
        <!-- Gallery + details-->
        <div class="bg-light shadow-lg rounded-3 px-4 py-3 mb-5" style="padding-left:0px!important">
          <div class="px-lg-3">
            <div class="row">




<style>
@media (min-width: 993px) {
  .main_pic_height {
    max-height: 600px;
  }
}

@media (max-width: 992px) {

  .main_pic_height {
    max-height: 300px;
  }

}


</style>


 <div class="col-lg-12 pe-lg-0">

<div class="row">

              <!-- Product gallery-->
              <div class="col-lg-8 pe-lg-0">



<div class="gallery">
  <div class="order-sm-2" style="padding-bottom:5px;margin: 0 auto;text-align:center">
    <a href="/images/armaf-delights-island-bliss-11189-1-l.webp" class="gallery-item" id="api_main_image_url" title="Armaf Delights Island Bliss agua de perfume para mujeres">
      <img src="/images/armaf-delights-island-bliss-11189-1-l.webp" alt="Armaf Delights Island Bliss agua de perfume para mujeres" id="hlavni_obrazek" style="width:auto!important;margin: 0 auto" width=100% height=100% class="main_pic_height">
    </a>
  </div>



                  </div>



              </div>
              <!-- Product details-->

                  <script type="application/ld+json">
{
"@context": "http://schema.org",
"@type": "Product",
"name": "Armaf Delights Island Bliss agua de perfume para mujeres",
"description": "Armaf Delights Island Bliss agua de perfume para mujeres 100 ml",
"image": "https://www.ferwer.es/images/armaf-delights-island-bliss-11189-1-l.webp",
"offers": {
    "@type": "Offer",
    "priceCurrency": "EUR",
    "price": "37.75",
    "url": "https://www.ferwer.es/armaf-delights-island-bliss-agua-de-perfume-para-mujeres",
    "itemCondition": "http://schema.org/NewCondition",
    "availability": "http://schema.org/InStock",
    "priceValidUntil": "2026-02-01T23:59:59.000Z"
    },
"brand": {
    "@type": "Brand",
    "name": "Armaf"
    },
"sku": "PRF0229253",
"gtin13": "6295199800942"
}</script>
              <div class="col-lg-4 pt-4 pt-lg-0">
                <div class="product-details ms-auto pb-3">

                    <div style="text-align: center; margin-bottom: 15px; min-height: 50px;">
                        <h1 class="h4 text-dark mb-0 api_product_title" style="margin: 0; display: inline;">
                            Armaf Delights Island Bliss agua de perfume para mujeres                        </h1>
                        <span style="display:inline-block; margin-left:8px; vertical-align:middle;">
                            <button class="share-button-inline" aria-label="Share" onclick="(function(){try{if(navigator.share){navigator.share({url:window.location.href});}else{navigator.clipboard.writeText(window.location.href);alert('El enlace se ha copiado al portapapeles');}}catch(e){}})()">
    <svg viewBox="0 0 20 20" width="22" height="22" >
        <path d="M9.99,1a.673.673,0,0,0-.461.192L6.862,3.807a.646.646,0,0,0-.183.637.659.659,0,0,0,.477.468.677.677,0,0,0,.649-.18l1.528-1.5v8.23a.654.654,0,0,0,.33.574.684.684,0,0,0,.673,0,.651.651,0,0,0,.33-.574V3.232l1.53,1.5a.675.675,0,0,0,.648.18.661.661,0,0,0,.477-.468.646.646,0,0,0-.183-.637L10.471,1.192A.671.671,0,0,0,9.99,1Z"/>
        <path d="M6,6.23A1.992,1.992,0,0,0,4,8.192v7.846A1.991,1.991,0,0,0,6,18h8a1.991,1.991,0,0,0,2-1.962V8.192a1.991,1.992,0,0,0-2-1.961H12.667V7.539H14a.65.65,0,0,1,.667.653v7.846a.65.65,0,0,1-.667.654H6a.65.65,0,0,1-.667-.654V8.192A.65.65,0,0,1,6,7.539H7.333V6.23Z"/>
    </svg>
</button>
<style>
  .share-button-inline{background:none;border:none;padding:0;cursor:pointer;display:inline-flex;align-items:center}
  .share-button-inline svg{vertical-align:middle}
</style>
                        </span>
                    </div>


                  <center style="color:#000000">Marca: <a href="/armaf" style="color:#000000;text-decoration:underline" title="Armaf">Armaf</a><br></center><br>

                    <div class="text-center mb-4">
                    <style>
                      /* Better highlight for the currently selected variant (size/volume) */
                      .change-group-product {
                        position: relative;
                        transition: background-color .15s ease, box-shadow .15s ease, transform .05s ease;
                      }
                      /* Active variant when IN STOCK - green */
                      .change-group-product.active.in-stock {
                        background-color: #2a8f4e !important; /* dark green */
                        color: #ffffff !important;              /* white text */
                        border-color: #2a8f4e !important;
                        box-shadow: 0 0 0 3px rgba(42, 143, 78, 0.35) inset, 0 0 0 2px #2a8f4e;
                      }
                      .change-group-product.active.in-stock .group-product-small-price,
                      .change-group-product.active.in-stock .group-product-status-word,
                      .change-group-product.active.in-stock b {
                        color: #ffffff !important;
                      }
                      .change-group-product.active.in-stock::after {
                        content: '\2713'; /* checkmark */
                        position: absolute;
                        top: -8px;
                        right: -8px;
                        width: 20px;
                        height: 20px;
                        border-radius: 50%;
                        background: #ffffff;
                        color: #2a8f4e;
                        border: 1px solid #2a8f4e;
                        font-weight: 700;
                        font-size: 12px;
                        line-height: 20px;
                        text-align: center;
                        box-shadow: 0 2px 6px rgba(0,0,0,.2);
                      }
                      /* Active variant when OUT OF STOCK - keep same light gray as inactive (btn-secondary) */
                      .change-group-product.active.out-of-stock {
                        /* Zachovat světle šedou barvu btn-secondary */
                      }
                      .change-group-product.active.out-of-stock .group-product-small-price,
                      .change-group-product.active.out-of-stock .group-product-status-word,
                      .change-group-product.active.out-of-stock b {
                        /* Zachovat původní barvy textu */
                      }
                      .change-group-product.active.out-of-stock::after {
                        content: '\2713'; /* checkmark */
                        position: absolute;
                        top: -8px;
                        right: -8px;
                        width: 20px;
                        height: 20px;
                        border-radius: 50%;
                        background: #ffffff;
                        color: #6c757d; /* šedá barva checkmarku */
                        border: 1px solid #6c757d;
                        font-weight: 700;
                        font-size: 12px;
                        line-height: 20px;
                        text-align: center;
                        box-shadow: 0 2px 6px rgba(0,0,0,.2);
                      }
                      .change-group-product:focus-visible {
                        outline: 3px solid #2a8f4e;
                        outline-offset: 2px;
                      }
                      .change-group-product:active { transform: translateY(1px); }
                    </style>
                    <button class="btn btn-md mr-2 btn-success change-group-product active in-stock" data-product="11189" title="Armaf Delights Island Bliss agua de perfume para mujer 100 ml"><b>100 ml</b><br><span class="group-product-small-price">37,75 €</span><br><span class="group-product-status-word">En stock</span></button>                    </div>

                  <div style="margin-bottom: 0px!important;text-align:center">
                    <!--<span class="badge bg-danger badge-shadow align-middle mt-n2" style="margin-top:10px!important">Výprodej</span><br><br>-->
                      <del class="text-muted fs-lg me-3"><span id="api_original_price">49,08</span> €</del><br>                      <span class="h3 fw-normal text-accent me-1"><span id="api_price">37,75</span> €</span>
                                      </div>
<br>
                  <div class="position-relative mb-3">
                      <div id="product-availability">

                    <div class="product-available" style="font-size:14px;text-align:center;background-color:none!important;color:green;">En stock - Enviamos en un plazo de 3 días</div>                      </div>
                  </div>
                    
                    
                  <form class="mb-grid-gutter" method="post" name="formdetail" id="formdetail" action="/">
                      <input type="hidden" name="btnclr" value="">
                     <input type="hidden" name="id_product" value="11189" id="id_product">
                     <input type="hidden" name="qty" value="1" id="product_page_product_qty">
                    <div class="mb-3" style="margin-top: 10px!important">
                    </div>

                    
                                        
                    <div class="mb-3 d-flex justify-content-center align-items-center gap-2 atc" >
                        <select class="form-select" id="qty_select" style="width:70px;font-size:1rem;text-align:center;padding-right:2rem" onchange="updateQty(this.value)">
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                        <option value="4">4</option>
                                                        <option value="5">5</option>
                                                        <option value="6">6</option>
                                                        <option value="7">7</option>
                                                        <option value="8">8</option>
                                                        <option value="9">9</option>
                                                        <option value="10">10</option>
                                                    </select>
                        <button type="button" id="addToCartBtn" class="addToCartBtn btn btn-success2" onclick="addToCartWithFeedback2($('#id_product').val()); showRelatedProducts($('#id_product').val())">
                            <i class="ci-cart fs-lg me-2"></i> Añadir al carrito                        </button>
                        <button class="addToCartBtnPlaceholder btn btn-success2 d-none" style="display: none;"><i class="ci-check fs-lg"></i></button>
                    </div>

                    <!--<div class="mb-3 d-flex align-items-center">
                        <button disabled class="btn btn-success2 a d-block w-100" type="submit"><i class="fs-lg me-2"></i>No disponible</button>
                    </div>-->

                    <div class="d-flex align-items-center ntfm" style="display:none!important">
                    
    <button
            type="button"
            class="btn btn-secondary d-block w-100 mt-1 ntfm"
            id="watchdog"
            data-id="11189"
            data-bs-toggle="modal"
            data-bs-target="#wdm"
            style="display:none!important"
    >Supervisar la disponibilidad</button>

<div class="modal fade" id="wdm" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <form method="post" id="watchdog_form">
                <div class="modal-header">
                    <h5 class="modal-title">Controlar la disponibilidad de mercancías</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="wdm_body">
                    <p>Notificarme cuando haya existencias por correo electrónico:</p>
                    <input type="email" name="email" id="w_email" placeholder="your@email.com" class="form-control" required value="">
                    <input type="hidden" name="product_id" id="w_product_id">
                    <input type="hidden" name="lang" id="w_lang" value="es">
                </div>
                <div class="modal-footer">
                    <button type="button" id="wdm_cancel" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" id="wdm_submit" class="btn btn-primary btn-sm">Establecer el seguimiento</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {

         $('#wdm').on('shown.bs.modal', function (e) {
          console.log('modal opened');
          var caller = $(e.relatedTarget);
          var modal = $(this);
          $('#w_product_id').val(caller.data('id'));
          $('#w_email').focus();
          });

    $("#watchdog_form").on('submit', function(e){
           e.preventDefault();
           var form = $(this);
           console.log('parsley validate');

           form.parsley().validate();

           form.parsley().whenValidate().done(function(){
              //console.log('successfully validated');
              //console.log('parsley VALID');

               $('#wdm_submit').attr('disabled', 'disabled');
               $('#wdm_cancel').attr('disabled', 'disabled');

              $.ajax({
                url:'/api/v1/watchdog',
                method:"POST",
                data:form.serialize(),
                dataType:"json",
                success:function(data) {
                  console.log(data);
                  if(data.error)  {
                   /*$('.submit_error').hide();
                   $('.delivery_edit_' + data.error).show();
                   $('#edit_delivery_submit').removeAttr('disabled', '');
                   $('#edit_delivery_cancel').removeAttr('disabled', '');*/
                  }
                  if(data.status=='success') {
                   //alert('added');
                   $('#wdm_submit').remove();
                   $('#wdm_cancel').removeAttr('disabled', '').text('Cerrar');
                   $('#wdm_body').html('Se ha establecido un control de la disponibilidad de mercancías.');
                  }
                  else if(data.status=='error') {
                    $('#wdm_submit').remove();
                    $('#wdm_cancel').removeAttr('disabled', '').text('Cerrar');
                    $('#wdm_body').html('¡Incorrecto! No se ha podido configurar el seguimiento del artículo.');
                    }
                  },
                  error: function(data) {
                   console.log('ERROR');
                   console.log(data);
                  }
                  });

               });

           });

    });


</script>

                    </div>
                    
<div class="text-center" style="font-size:13px">Este producto está siendo visto actualmente 10 usuarios.</div>

<div class="text-center" style="font-size:13px"><a href="/programa-de-fidelidad" style="color:#4b566b;text-decoration:underline">Con la compra obtendrá <b id="api_points">943</b> puntos.</a></div>

<br>
<style>
  .benefits-list { list-style: none; margin: 0; padding: 0; text-align: left; font-weight: 600; font-size: 0.85rem; }
  .benefits-list li { display: flex; align-items: center; margin: 4px 0; }
  .benefits-list .check-icon { width: 16px; height: 16px; border-radius: 50%; background-color: #2a8f4e; display: inline-flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 6px; flex-shrink: 0; }
  .benefits-list .check-icon i { font-size: 10px; line-height: 1; }
  @media (max-width:576px) {
    .benefits-list { font-size: 0.9rem; padding-left: 10px; }
    .benefits-list .check-icon { width: 18px; height: 18px; margin-right: 8px; }
    .benefits-list .check-icon i { font-size: 11px; }
  }
</style>
<div class="card border-0 shadow">
  <div class="card-body text-start" style="padding:0.75rem!important">
    <ul class="benefits-list mb-0">
<li>
<span class="check-icon"><i class="ci-check"></i></span><span class="me-1">Envío gratis en pedidos superiores a 95 EUR</span>
</li>


        <li>
          <span class="check-icon"><i class="ci-check"></i></span><span class="me-1">Los pedidos realizados antes de las 12:00 horas se envían inmediatamente</span>
        </li>
        <li>
          <span class="check-icon"><i class="ci-check"></i></span><span class="me-1">Cambios y devoluciones gratuitos dentro de los 90 días</span>
        </li>

    </ul>
  </div>
</div>

                                      </form>

                  <script>
                  function updateQty(val) {
                      var qty = parseInt(val) || 1;
                      if(qty < 1 || qty > 10) qty = 1;
                      $('#product_page_product_qty').val(qty);
                  }
                  </script>








                  <!-- Sharing-->
                  <!-- <a class="btn-share btn-twitter me-2 my-2" href="https://twitter.com/intent/tweet?url=https://www.ferwer.es/armaf-delights-island-bliss-agua-de-perfume-para-mujeres"><i class="ci-twitter"></i>Twitter</a><a class="btn-share btn-facebook my-2" href="https://www.facebook.com/share.php?u=https://www.ferwer.es/armaf-delights-island-bliss-agua-de-perfume-para-mujeres"><i class="ci-facebook"></i>Facebook</a> -->
                </div>

              </div>


<div class="card border-0 shadow">
<div class="card-body text-left">

    <h2 class="h3 mb-4 pb-2">Descripción del producto <span class="api_product_title">Armaf Delights Island Bliss agua de perfume para mujeres</span></h2>
<span id="api_desc_short"><p>El agua perfumada <a href="/armaf" title="Armaf" class="linkinarticle">Armaf</a> Delights Island Bliss es una fragancia con notas florales, frutales y gourmet que te transportar&aacute; a una isla ex&oacute;tica llena de tranquilidad y belleza natural. La fragancia se abre con bayas silvestres estimulantes y notas verdes. El coraz&oacute;n revela flor de azahar, lirio de agua y cremoso coco, mientras que el haba tonka, la vainilla y el almizcle proporcionan un final c&aacute;lido y duradero. Una mezcla perfecta para una experiencia ex&oacute;tica y cautivadora. Date un respiro, d&eacute;jate llevar por esta fragancia &uacute;nica y disfruta de tu propio oasis tropical con cada inhalaci&oacute;n.</p></span><br><br>                    
      <h6 class="fs-sm mb-2">Código del producto</h6>
      <ul class="fs-sm ps-4 mb-0">
          <li><span id="api_sku">PRF0229253</span> </li>
      </ul>

</div>
</div>

            </div>
          </div>
        </div>
      </div>
    </div>




        <!-- Product description section 1-->
    <!-- Product carousel (You may also like)-->
    <div class="container px-0 px-md-3">
        <h2 class="h3 text-center">Los clientes suelen comprar este producto junto con otros <span class="api_product_title">Armaf Delights Island Bliss agua de perfume para mujeres</span></h2>
        <div class="tns-carousel tns-controls-static tns-controls-outside" style="margin-bottom:0px!important;">
            <div class="tns-carousel-inner"
                 data-carousel-options='{
                "items": 2,
                "controls": true,
                "nav": false,
                "loop": false,
                "rewind": true,
                "responsive": {
                    "0": {"items":2, "gutter": 4},
                    "500": {"items":2, "gutter": 18},
                    "768": {"items":3, "gutter": 20},
                    "1100": {"items":4, "gutter": 30}
                }
             }'>
                                    <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-club-de-nuit-a-collector-s-pride-white-parfum-gift-set">
                                <img data-src="/images/armaf-club-de-nuit-a-collector-s-pride-white-parfum-gift-set-1-m.webp" class="lazyload" alt="Armaf Club De Nuit Parfum A Collector's Pride set de regalo para mujeres agua perfumada Club De Nuit Women 30 ml + agua perfumada Club De Nuit Milestone 30 ml + agua perfumada Club De Nuit Intense Woman 30 ml"
                                     data-full-size-image-url="/images/armaf-club-de-nuit-a-collector-s-pride-white-parfum-gift-set-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-club-de-nuit-a-collector-s-pride-white-parfum-gift-set">Armaf Club De Nuit Parfum A Collector's Pride set de regalo para mujeres agua perfumada Club De Nuit Women 30 ml + agua perfumada Club De Nuit Milestone 30 ml + agua perfumada Club De Nuit Intense Woman 30 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">84,89 €</del><br>
                                                                                <span class="text-accent">59,39 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-30%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-club-de-nuit-sillage-a-collector-s-pride-gift-set">
                                <img data-src="/images/armaf-club-de-nuit-sillage-a-collector-s-pride-gift-set-1-m.webp" class="lazyload" alt="Armaf Club de Nuit Sillage A Collector's Pride Gift Set"
                                     data-full-size-image-url="/images/armaf-club-de-nuit-sillage-a-collector-s-pride-gift-set-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-club-de-nuit-sillage-a-collector-s-pride-gift-set">Armaf Club de Nuit Sillage A Collector's Pride Gift Set</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">69,26 €</del><br>
                                                                                <span class="text-accent">53,29 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-23%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-club-de-nuit-untold-edp-105-ml-dst-75-g-bl-100-ml-unisex">
                                <img data-src="/images/armaf-club-de-nuit-untold-edp-105-ml-dst-75-g-bl-100-ml-unisex-1-m.webp" class="lazyload" alt="Armaf Armaf Club de Nuit Untold EDP 105 ml + DST 75 g + BL 100 ml UNISEX"
                                     data-full-size-image-url="/images/armaf-club-de-nuit-untold-edp-105-ml-dst-75-g-bl-100-ml-unisex-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-club-de-nuit-untold-edp-105-ml-dst-75-g-bl-100-ml-unisex">Armaf Armaf Club de Nuit Untold EDP 105 ml + DST 75 g + BL 100 ml UNISEX</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">82,67 €</del><br>
                                                                                <span class="text-accent">63,60 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-23%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-odyssey-limoni-fresh-edition-agua-de-perfume-unisex">
                                <img data-src="/images/armaf-odyssey-limoni-fresh-edition-9813-1-m.webp" class="lazyload" alt="Armaf Odyssey Limoni Fresh Edition eau de parfum unisex 100 ml"
                                     data-full-size-image-url="/images/armaf-odyssey-limoni-fresh-edition-9813-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-odyssey-limoni-fresh-edition-agua-de-perfume-unisex">Armaf Odyssey Limoni Fresh Edition eau de parfum unisex 100 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">32,23 €</del><br>
                                                                                <span class="text-accent">21,97 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-32%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-le-femme-agua-de-perfume-para-mujeres">
                                <img data-src="/images/armaf-le-femme-11507-1-m.webp" class="lazyload" alt="Armaf Le Femme agua de perfume para mujeres 100 ml"
                                     data-full-size-image-url="/images/armaf-le-femme-11507-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-le-femme-agua-de-perfume-para-mujeres">Armaf Le Femme agua de perfume para mujeres 100 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">30,06 €</del><br>
                                                                                <span class="text-accent">23,14 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-23%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-beau-ellegant-agua-de-perfume-para-mujeres">
                                <img data-src="/images/armaf-beau-ellegant-9308-1-m.webp" class="lazyload" alt="Armaf Beau Ellegant agua de perfume para mujer 100 ml"
                                     data-full-size-image-url="/images/armaf-beau-ellegant-9308-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-beau-ellegant-agua-de-perfume-para-mujeres">Armaf Beau Ellegant agua de perfume para mujer 100 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">30,83 €</del><br>
                                                                                <span class="text-accent">20,47 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-34%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-club-de-nuit-blue-iconic-eau-de-parfum-para-hombres">
                                <img data-src="/images/armaf-club-de-nuit-blue-iconic-9442-1-m.webp" class="lazyload" alt="Armaf Club De Nuit Blue Iconic agua de perfume para hombre 105 ml"
                                     data-full-size-image-url="/images/armaf-club-de-nuit-blue-iconic-9442-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-club-de-nuit-blue-iconic-eau-de-parfum-para-hombres">Armaf Club De Nuit Blue Iconic agua de perfume para hombre 105 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">50,97 €</del><br>
                                                                                <span class="text-accent">39,20 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-23%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-club-de-nuit-parfum-a-collector-s-pride-set-de-regalo-para-mujeres">
                                <img data-src="/images/armaf-club-de-nuit-parfum-a-collector-s-pride-9334-1-m.webp" class="lazyload" alt="Armaf Club De Nuit Parfum A Collector's Pride set de regalo para mujeres agua perfumada Club De Nuit Women 30 ml + agua perfumada Club De Nuit Milestone 30 ml + agua perfumada Club De Nuit Intense Woman 30 ml"
                                     data-full-size-image-url="/images/armaf-club-de-nuit-parfum-a-collector-s-pride-9334-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-club-de-nuit-parfum-a-collector-s-pride-set-de-regalo-para-mujeres">Armaf Club De Nuit Parfum A Collector's Pride set de regalo para mujeres agua perfumada Club De Nuit Women 30 ml + agua perfumada Club De Nuit Milestone 30 ml + agua perfumada Club De Nuit Intense Woman 30 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">81,75 €</del><br>
                                                                                <span class="text-accent">57,69 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-29%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                        <div>
                        <div class="card product-card card-static">
                            <a class="card-img-top d-block overflow-hidden" href="/armaf-aura-agua-de-perfume-para-hombre">
                                <img data-src="/images/armaf-aura-8947-1-m.webp" class="lazyload" alt="Armaf Aura agua de perfume para hombre 100 ml"
                                     data-full-size-image-url="/images/armaf-aura-8947-1-m.webp" style="height:150px">
                            </a>
                            <div class="card-body py-2">
                                <h3 class="product-title fs-sm mb-2"><a href="/armaf-aura-agua-de-perfume-para-hombre">Armaf Aura agua de perfume para hombre 100 ml</a></h3>
                                <div class="d-flex justify-content-between">
                                    <div class="product-price">
                                                                                    <del class="fs-sm text-muted">27,49 €</del><br>
                                                                                <span class="text-accent">21,15 €</span>
                                    </div>
                                                                            <span class="badge bg-danger" style="height:25px;position:initial;">-23%</span>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                                </div>
        </div>
    </div>

    <style>
        /* Zabraň, aby název produktu najížděl do ceny (mobile) */
        .tns-carousel .product-card .product-title {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.6em; /* rezerva pro 2 řádky */
        }
        @media (max-width: 576px) {
            /* zúžit vnitřní vodorovné odsazení, aby karta byla širší */
            .tns-carousel .product-card .card-body { padding-left: .25rem; padding-right: .25rem; }
            /* odstranit vnitřní padding karuselu pro šipky */
            .tns-controls-static { padding-left: 0 !important; padding-right: 0 !important; }
        }
        /* Základní styly pro carousel */
        .tns-carousel {
            position: relative;
            margin-bottom: 3rem;
        }

        .tns-carousel-inner {
            position: relative;
        }

        /* Styly pro kontrolní prvky */
        .tns-controls-static {
            position: relative;
            padding: 0 40px;
        }

        .tns-controls-static button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 35px;
            height: 35px;
            border: 1px solid #e3e9ef;
            border-radius: 50%;
            background-color: #fff;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s ease-in-out;
            z-index: 1;
        }

        /* Výchozí stav navigačních tlačítek */
        .tns-controls-static button[data-controls="prev"] {
            left: 0;
            visibility: hidden;
        }

        .tns-controls-static button[data-controls="next"] {
            right: 0;
            visibility: visible;
        }

        /* Hover efekty */
        .tns-controls-static button:hover {
            background-color: #f3f5f9;
            color: #4b566b;
        }

        /* Třída pro aktivní tlačítko */
        .tns-controls-static button.active {
            visibility: visible;
        }

        /* Responzivní úpravy */
        @media (max-width: 500px) {
            .tns-controls-static {
                padding: 0 30px;
            }
            .tns-controls-static button {
                width: 30px;
                height: 30px;
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Počkáme na inicializaci tiny-slider
            setTimeout(function() {
                const slider = document.querySelector('.tns-carousel-inner');
                const prevButton = document.querySelector('.tns-controls-static button[data-controls="prev"]');
                const nextButton = document.querySelector('.tns-controls-static button[data-controls="next"]');

                if (slider && prevButton && nextButton) {
                    // Nastavení výchozího stavu
                    prevButton.style.visibility = 'hidden';
                    nextButton.style.visibility = 'visible';

                    // Získáme instanci Tiny Slider
                    const tnsInstance = slider.parentNode.parentNode.tns;

                    if (tnsInstance) {
                        // Funkce pro kontrolu pozice
                        function updateNavigation() {
                            const info = tnsInstance.getInfo();

                            // Kontrola pro levé tlačítko
                            if (info.index <= 0) {
                                prevButton.style.visibility = 'hidden';
                            } else {
                                prevButton.style.visibility = 'visible';
                            }

                            // Kontrola pro pravé tlačítko
                            if (info.index >= info.slideCount - info.items) {
                                nextButton.style.visibility = 'hidden';
                            } else {
                                nextButton.style.visibility = 'visible';
                            }
                        }

                        slider.addEventListener('transitionend', updateNavigation);
                        tnsInstance.events.on('indexChanged', updateNavigation);
                        updateNavigation();
                    }
                }
            }, 300);
        });
    </script>

<div style="text-align:center">
  <button type="button" class="btn btn-secondary" onclick="location.href='aguas-perfumadas'">Volver a la categoría<br>Aguas perfumadas</button>
  <button type="button" class="btn btn-secondary ms-2" onclick="location.href='/armaf'">Armaf</button><br><br>
</div>
      </div>
    </main>

    <!-- Large modal-->
    <div class="modal fade" id="modalLarge" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Producto añadido al carrito</h4>
                    <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="fs-sm"></p>

                    <div>
                        <div style="display: inline-block;width:120px;">
                            <button class="btn btn-secondary btn-sm" type="button" data-bs-dismiss="modal">Seguir comprando</button>
                        </div>
                        <div style="display: inline-block;float:right">
                            <button class="btn btn-primary btn-shadow btn-sm" type="button" onclick="location.href='/cart' ">Ir al carrito ></button>
                        </div>
                    </div>

                    <!-- Upravený horizontální div s podmíněným zobrazením -->
                    <div class="mt-3">
                        <div id="shippingInfo">
                            <p><span id="remainingText">Para envío gratis te faltan: </span><span id="remainingAmount"></span></p>
                            <div id="shippingStatus" class="d-flex justify-content-center align-items-center" style="height: 25px; background-color: #f8f9fa; border-radius: 5px;">
                                <!-- Zde bude zobrazen buď progress bar nebo text "Free Shipping" -->
                            </div>
                            <div id="targetAmountDiv" style="display: flex; justify-content: flex-end; margin-top: 5px;">
                                <span id="targetAmount">95 €</span>
                            </div>
                        </div>
                    </div>

                    <script>
                        // Konstanty
                        const FREE_SHIPPING_THRESHOLD = 95; // Hranice pro dopravu zdarma

                        // Funkce pro aktualizaci progress baru a zbývající částky
                        function updateShippingProgress(currentAmount) {
                            const remainingAmount = Math.max(0, FREE_SHIPPING_THRESHOLD - currentAmount);
                            const shippingStatusDiv = document.getElementById('shippingStatus');
                            const shippingInfoDiv = document.getElementById('shippingInfo');

                            if (currentAmount >= FREE_SHIPPING_THRESHOLD) {
                                // Zobrazení textu "Free Shipping" se zelenou fajfkou
                                shippingInfoDiv.innerHTML = `
                    <div id="shippingStatus" class="d-flex justify-content-center align-items-center" style="height: 25px; background-color: #d4edda; border-radius: 5px;">
                        <span style="color: green;">✓ Envío gratis</span>
                    </div>
                `;
                            } else {
                                // Aktualizace textu zbývající částky
                                document.getElementById('remainingAmount').textContent = remainingAmount + ' €';

                                // Zobrazení progress baru
                                const percentage = Math.min(100, (currentAmount / FREE_SHIPPING_THRESHOLD) * 100);
                                shippingStatusDiv.innerHTML = `
                    <div class="progress" style="height: 25px; width: 100%;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: ${percentage}%;" aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100">
                            <span style="position: absolute; left: 5px; color: white;"></span>
                        </div>
                    </div>
                `;
                            }
                        }

                        // Příklad použití - toto je řádek, který budete měnit
                        updateShippingProgress(); // Zde změňte hodnotu podle aktuální částky v košíku
                    </script>

                    <div id="modalContentArea"></div>
                </div>


            </div>

        </div>
    </div>

<script>
    $(document).ready(function() {

                $('#footer-price-row').show();
        
        // Keep original product title to use as a safe fallback
        var initialProductTitle = $('.api_product_title').first().text().trim();

        $('.change-group-product').click(function() {

            $('.change-group-product').each(function() {
                $(this).removeClass('active in-stock out-of-stock');
            });

            var el = $(this);
            // Přidat active + správnou třídu podle skladu
            var stockClass = $(el).hasClass('btn-success') ? 'in-stock' : 'out-of-stock';
            $(el).addClass('active ' + stockClass);
            var product_id = $(el).data('product');
            $('#id_product').val(product_id);

            $.post("/api/v1/getproductdetails", { id: product_id })
                .done(function(data) {
                    console.log("Data Loaded:", data);

                    if(data.id==product_id) {

                        console.log("data.stock = " + data.stock);

                        if(data.stock==1) {
                            $('#footer-price-row').show();
                        }
                        else {
                            $('#footer-price-row').hide();
                        }

                        // Prefer full product name; fallback to search name; finally fallback to original
                        $('.api_product_title').text((data.nazev && data.nazev.trim()) || (data.nazev_search && data.nazev_search.trim()) || initialProductTitle);
                        $('#api_original_price').text(data.original_price);
                        $('#api_price,#api_price2').text(data.price);
                        $('#api_points').text(data.points);
                        $('#api_sku').text(data.sku);
                        $('#api_ean_id').text(data.ean + " " + data.id);
                        //$('#api_desc_short').html(data.desc_short);
                        if(data.img) {
                            $('#api_main_image_url').attr('href', '/images/' + data.img);
                            $('#hlavni_obrazek').attr('src', '/images/' + data.img);
                        }
                        $('title').text(data.nazev);
                        $('meta[name="description"]').attr('content', data.metadesc);
                        $('meta[name="keywords"]').attr('content', data.kw);

                        $('#product-availability').html(data.grsd);

                        if(data.grsd.includes("HATC")) {
                            console.log('contains hatcs');
                            $('.atc').attr('style', 'display: none !important');
                            $('.ntfm').attr('style', 'display: flex !important');
                        }
                        else {
                            console.log('does not contain HATC');
                            $('.atc').attr('style', 'display: flex !important; justify-content: center; align-items: center; gap: 0.5rem;');
                            $('.ntfm').attr('style', 'display: none !important');
                        }

                        var currentUrl = window.location.pathname;
                        var productUrlRegex = /\/p-\d+\//;
                        if (productUrlRegex.test(currentUrl)) {
                            var newUrl = currentUrl.replace(/\/p-\d+\//, `/p-${data.id}/`);
                        } else {
                            var newUrl = currentUrl.replace(/\/$/, '') + `/p-${data.id}/`;
                        }
                        history.pushState({}, '', newUrl);
                    }

                })
                .fail(function(xhr, status, error) {
                    console.error("Error loading product details:", error);
                });

        });

        function addToCartWithFeedback2(productId) {
            var qty = $('#product_page_product_qty').val() || 1;
            qty = parseInt(qty);
            if(qty < 1 || qty > 10) qty = 1;
            
            $.ajax({
                url: '/cart',
                type: 'POST',
                data: {
                    id_product: productId,
                    qty: qty
                },
                success: function(response) {
                    // Show success feedback
                    $('.addToCartBtn').hide();
                    $('.addToCartBtnPlaceholder').removeClass('d-none').show();
                    
                    // Show related products modal (nová logika)
                    showRelatedProducts(productId);
                    
                    // Update cart count if needed
                    if (typeof updateCartCount === 'function') {
                        updateCartCount();
                    }
                }
            });
        }
    });

</script>
  <script>
      /*window.onload = function() {
          const container = document.getElementById('scrollContainer');
          container.scrollLeft = container.scrollWidth;
      };*/
  </script>

<script>
    // Přidáno z detail2.php pro správné načítání related products do modalu
    let shownProductIds = new Set();
    let currentListener = null;
    
    function add_to_cart_no_redirect(productId) {
        // Make the AJAX call without redirecting
        $.post("/ajax.php", { action: "add_to_cart", id: productId }, function(response) {
            // Optional: Update any cart counters or indicators here
        });
    }

    function showRelatedProducts(productId) {
        var modal = document.getElementById('modalLarge');
        
        // Remove any existing listener
        if (currentListener) {
            modal.removeEventListener('shown.bs.modal', currentListener);
        }
        
        // Create new listener if we haven't shown this product's related items
        if (!shownProductIds.has(productId)) {
            currentListener = function() {
                fetch('/get_related_products.php?product_id=' + productId)
                    .then(response => response.text())
                    .then(data => {
                        // Najdi pouze obsah <div class="modal-body"> z odpovědi
                        var parser = new DOMParser();
                        var doc = parser.parseFromString(data, 'text/html');
                        var modalBody = doc.querySelector('.modal-body');
                        if (modalBody) {
                            document.getElementById('modalContentArea').innerHTML = modalBody.innerHTML;
                        } else {
                            document.getElementById('modalContentArea').innerHTML = data;
                        }
                        shownProductIds.add(productId);
                    });
            };
            
            modal.addEventListener('shown.bs.modal', currentListener);
        }
        
        var modalInstance = new bootstrap.Modal(modal);
        modalInstance.show();
    }
</script>

<!-- Přidej div pro related products do modalLarge -->
<div id="modalContentArea"></div>

<script>
// Úprava addToCartWithFeedback2, aby používala nový modal a showRelatedProducts
function addToCartWithFeedback2(productId) {
    var qty = $('#product_page_product_qty').val() || 1;
    qty = parseInt(qty);
    if(qty < 1 || qty > 10) qty = 1;
    
    $.ajax({
        url: '/cart',
        type: 'POST',
        data: {
            id_product: productId,
            qty: qty
        },
        success: function(response) {
            // Show success feedback
            $('.addToCartBtn').hide();
            $('.addToCartBtnPlaceholder').removeClass('d-none').show();
            
            // Show related products modal (nová logika)
            showRelatedProducts(productId);
            
            // Update cart count if needed
            if (typeof updateCartCount === 'function') {
                updateCartCount();
            }
        }
    });
}
</script>    <footer class="footer pt-5" style="background-color: #469759;">
      <div class="container">
        <div class="row pb-2">


          <div class="col-md-4 col-sm-6">
            <div class="widget widget-links widget-light pb-2 mb-4">
              <h3 class="widget-title text-light">Ferwer</h3>
              <ul class="widget-list">
                <li class="widget-list-item"><a class="widget-list-link" href="/sobre-nosotros">Quiénes somos</a></li>

                  
              </ul>


                
            </div>
          </div>


          <div class="col-md-4 col-sm-6">
            <div class="widget widget-links widget-light pb-2 mb-4">
              <h3 class="widget-title text-light">Todo sobre la compra</h3>
              <ul class="widget-list">
<li class="widget-list-item"><a class="widget-list-link" href="/transporte-y-pago">Transporte y pago</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/cambios-devoluciones-y-reclamaciones">Cambios, devoluciones y reclamaciones</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/"></a> </li><li class="widget-list-item"><a class="widget-list-link" href="/programa-de-fidelidad">Programa de fidelidad</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/contacte-con">Contacte con</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/terminos-y-condiciones">Términos y condiciones</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/sobre-nosotros">Quiénes somos</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/como-medir-la-longitud-del-pie">Cómo medir la longitud del pie</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/declaracion-sobre-el-uso-de-cookies">Declaración sobre el uso de cookies</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/proteccion-de-datos-personales">Protección de datos personales</a> </li><li class="widget-list-item"><a class="widget-list-link" href="/pie-de-imprenta">Pie de imprenta</a> </li>  <li class="widget-list-item"><a href="#" class="widget-list-link" id="open_preferences_center">Cookies</a></li>
              </ul>
            </div>
            <div class="widget widget-links widget-light pb-2 mb-4">

            </div>
          </div>






            <div class="col-md-4">
                <div class="widget pb-2 mb-4">
                    <h3 class="widget-title text-light pb-1">Suscríbase a nuestro boletín de noticias</h3>
                    <form class="" action="/newsletter" method="post" name="mc-embedded-subscribe-form">
                        <div class="input-group flex-nowrap"><i class="ci-mail position-absolute top-50 translate-middle-y text-muted fs-base ms-3"></i>
                            <input class="form-control rounded-start" type="email" name="email" placeholder="Su correo electrónico" required>
                            <button class="btn btn-primary" type="submit" name="subscribe">Entrar en el sistema</button>
                        </div>
                    </form>
                </div>

                <div class="widget pb-4 mb-4">
                    <div class="topbar-text dropdown disable-autohide">
                        <a class="topbar-link lang-widget-bottom rounded dropdown-toggle" href="#" data-bs-toggle="dropdown"><img class="me-2" src="/img/flags/es.svg" width="20" height="20" alt="Español">Español / EUR</a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            
                            <li><a class="dropdown-item pb-1" href="https://www.ferwer.cz"><img class="me-2" src="/img/flags/cs.svg" width="20" height="20" alt="Česky">Česky</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.dk"><img class="me-2" src="/img/flags/dk.svg" width="20" height="20" alt="Dansk">Dansk</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.de"><img class="me-2" src="/img/flags/de.svg" width="20" height="20" alt="Deutsch">Deutsch</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.at"><img class="me-2" src="/img/flags/at.svg" width="20" height="20" alt="Deutsch">Deutsch</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.com"><img class="me-2" src="/img/flags/eu.svg" width="20" height="20" alt="English">English</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.es"><img class="me-2" src="/img/flags/es.svg" width="20" height="20" alt="Español">Español</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.fr"><img class="me-2" src="/img/flags/fr.svg" width="20" height="20" alt="Français">Français</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.be"><img class="me-2" src="/img/flags/be.svg" width="20" height="20" alt="Français">Français</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.it"><img class="me-2" src="/img/flags/it.svg" width="20" height="20" alt="Italiano">Italiano</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.hu"><img class="me-2" src="/img/flags/hu.svg" width="20" height="20" alt="Magyar">Magyar</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.nl"><img class="me-2" src="/img/flags/nl.svg" width="20" height="20" alt="Nederlands">Nederlands</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.pl"><img class="me-2" src="/img/flags/pl.svg" width="20" height="20" alt="Polski">Polski</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.pt"><img class="me-2" src="/img/flags/pt.svg" width="20" height="20" alt="Português">Português</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.si"><img class="me-2" src="/img/flags/si.svg" width="20" height="20" alt="Slovenščina">Slovenščina</a></li><li><a class="dropdown-item pb-1" href="https://www.ferwer.sk"><img class="me-2" src="/img/flags/sk.svg" width="20" height="20" alt="Slovensky">Slovensky</a></li>                        </ul>
                    </div>
                </div>

<div style="display: flex; justify-content: center; align-items: center;">
    <div style="text-align: center; margin-right: 1.5rem;">
        <a href="https://www.google.com/search?q=ferwer" target="_blank"><img src="/img/google-rating.png" alt="Google" width="90" style="margin-bottom: 0.5rem; border-radius: 8px;"></a>
        <div style="color:white;"><strong>4,7/5</strong></div>
    </div>
    <div style="text-align: center; margin-right: 1.5rem;">
        <a href="https://obchody.heureka.cz/ferwer-cz/recenze/" target="_blank"><img src="/img/heureka-rating.png" alt="Heureka" width="90" style="margin-bottom: 0.5rem; border-radius: 8px;"></a>
        <div style="color:white;"><strong>97%</strong></div>
    </div>
    <div style="text-align: center;">
        <a href="https://www.trustpilot.com/review/ferwer.es" target="_blank"><img src="/img/trustpilot-rating.jpg" alt="Trustpilot" width="90" style="margin-bottom: 0.5rem; border-radius: 8px;"></a>
        <div style="color:white;"><strong>4,1/5</strong></div>
    </div>
</div>


                            </div>









        </div>
      </div>
      <div class="pt-5" style="background-color: #367444;">
        <div class="container">
          <div class="row pb-3">
            <div class="col-md-4 col-sm-6 mb-4">
              <div class="d-flex"><i class="ci-rocket" style="font-size: 2.25rem;color:white"></i>
                <div class="ps-3">
                    <h6 class="fs-base text-light mb-1">Al día siguiente y de forma gratuita</h6>
                  <p class="mb-0 fs-ms text-light opacity-50">Envío gratuito para pedidos superiores a 95 EUR</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-6 mb-4">
              <div class="d-flex"><i class="ci-currency-exchange" style="font-size: 2.25rem;color:white"></i>
                <div class="ps-3">
                  <h6 class="fs-base text-light mb-1">Cambios y devoluciones gratuitos</h6>
                  <p class="mb-0 fs-ms text-light opacity-50">Puede devolver o cambiar su pedido en cualquier momento en un plazo de 90 días</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-6 mb-4">
              <div class="d-flex"><i class="ci-help" style="font-size: 2.25rem;color:white"></i>
                <div class="ps-3">
                  <h6 class="fs-base text-light mb-1">Apoyo de Trees.org</h6>
                  <p class="mb-0 fs-ms text-light opacity-50">Por cada pedido plantamos un árbol. Leer más <a href="/sobre-nosotros">Quiénes somos</a>.</p>
                </div>
              </div>
            </div>
          </div>
          <hr class="hr-light mb-5">
          <div class="row pb-2">
            <div class="col-md-6 text-center text-md-start mb-4">

              <div class="text-nowrap mb-4"><a class="d-inline-block align-middle mt-n1 me-3" href="/"><img class="d-block" src="/img/ferwer-logo.png" width="154" height="40" alt="Armaf Delights Island Bliss agua de perfume para mujeres 100 ml | Ferwer"></a>
              </div>
            </div>
            <div class="col-md-6 text-center text-md-end mb-4">
              <div class="mb-3">
                <a class="btn-social bs-light bs-facebook ms-2 mb-2" href="https://www.facebook.com/ferwer.cz/"><i class="ci-facebook"></i></a>
                <a class="btn-social bs-light bs-instagram ms-2 mb-2" href="https://www.instagram.com/ferwer.cz/"><i class="ci-instagram"></i></a>
            </div>
          </div>
        </div>
        <div class="pb-4 fs-xs text-light opacity-50 text-center text-md-start">© Topshelf s.r.o. Todos los derechos reservados. </div>
      </div>
      </div>
    </footer>

    <!-- Toolbar for handheld devices (Default)-->
    <div class="handheld-toolbar">

        
            
            <div class="d-lg-none" id="footer-price-row" style="display:none">
                <div class="d-table table-layout-fixed w-100 border-bottom py-2" style="border-bottom: 1px solid #e3e9ef;">
                    <div class="d-table-cell align-middle" style="width:35%">
                        <span class="price-box text-center d-block" style="font-size:1rem;font-weight:600"><span id="api_price2">37,75</span> €</span>
                    </div>
                    <div class="d-table-cell align-middle" style="width:65%;padding-right:5px">
                        <div class="d-flex gap-2 justify-content-end">
                            <select class="form-select form-select-sm" id="footer_qty_select" onchange="updateQty(this.value)" style="width:65px;font-size:0.95rem;text-align:center;padding-right:1.8rem">
                                                                <option value="1">1</option>
                                                                <option value="2">2</option>
                                                                <option value="3">3</option>
                                                                <option value="4">4</option>
                                                                <option value="5">5</option>
                                                                <option value="6">6</option>
                                                                <option value="7">7</option>
                                                                <option value="8">8</option>
                                                                <option value="9">9</option>
                                                                <option value="10">10</option>
                                                            </select>
                            <button id="addToCartBtn" class="addToCartBtn btn btn-success2" onclick="add_to_cart(11189); showRelatedProducts(11189)" style="font-size:0.85rem;padding:0.5rem 1rem;white-space:nowrap">
                                <i class="ci-cart fs-base me-1"></i> Añadir al carrito                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                function addToCartWithFeedback2(prodId) {
                    add_to_cart(prodId);

                    $('.addToCartBtn').removeClass('d-block').addClass('d-none');
                    $('.addToCartBtnPlaceholder').removeClass('d-none').addClass('d-block');

                    setTimeout(function() {
                        $('.addToCartBtn').removeClass('d-none').addClass('d-block');
                        $('.addToCartBtnPlaceholder').removeClass('d-block').addClass('d-none');
                    }, 3000);
                }

                function addToCartWithFeedback(prodId) {
                    // Původní funkce pro přidání do košíku
                    add_to_cart(prodId);

                    // Show related products modal
                    var modal = document.getElementById('modalLarge');
                    if (modal) {
                        var modalInstance = new bootstrap.Modal(modal);
                        modalInstance.show();
                        
                        // Fetch and display related products
                        fetch('/get_related_products.php?product_id=' + prodId)
                            .then(response => response.text())
                            .then(data => {
                                document.getElementById('modalContentArea').innerHTML = data;
                            });
                    }

                    // Změna vzhledu všech tlačítek s třídou 'addToCartBtn'
                    const buttons = document.querySelectorAll('.addToCartBtn');
                    buttons.forEach(btn => {
                        const originalContent = btn.innerHTML;
                        btn.innerHTML = '<i class="ci-check fs-lg"></i>';
                        btn.disabled = true;
                    });
                }
            </script>

        
        <div class="d-table table-layout-fixed w-100">
            <!-- Category menu -->
            <a class="d-table-cell handheld-toolbar-item" href="javascript:void(0)" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" onclick="window.scrollTo(0, 0)">
                <span class="handheld-toolbar-icon"><i class="ci-menu"></i></span>
                <span class="handheld-toolbar-label">Categoría</span>
            </a>

            <!-- Search icon -->
            <a class="d-table-cell handheld-toolbar-item mobile-search-trigger" href="javascript:void(0)">
                <span class="handheld-toolbar-icon"><i class="ci-search"></i></span>
                <span class="handheld-toolbar-label">Buscar en</span>
            </a>

            <!-- Cart icon -->
                        <a class="d-table-cell handheld-toolbar-item" href="/cart">
                <span class="handheld-toolbar-icon"><i class="ci-cart"></i>
                    <span class="badge bg-primary rounded-pill ms-1" id="cart_badge2" style="display:none;"><span class="navbar-tool-label" id="cart_pieces2">0</span></span>
                </span>
                <span class="handheld-toolbar-label" id="cart_total3">Cesta</span>
            </a>

        </div>
    </div>

    <!-- Sign in / sign up modal-->
<div class="modal fade" id="signin-modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

                <div class="modal-header bg-secondary">
                    <ul class="nav nav-tabs card-header-tabs" role="tablist">
                        <li class="nav-item"><a class="nav-link fw-medium active" id="tab_login" href="#signin-tab" data-bs-toggle="tab" role="tab" aria-selected="true"><i class="ci-unlocked me-2 mt-n1"></i>Entrar en el sistema</a></li>
                        <li class="nav-item"><a class="nav-link fw-medium" id="tab_reg" href="#signup-tab" data-bs-toggle="tab" role="tab" aria-selected="false"><i class="ci-user me-2 mt-n1"></i>Registrarse</a></li>
                        <li class="nav-item" style="display: none"><a class="nav-link fw-medium" id="tab_recover" href="#recover-tab" data-bs-toggle="tab" role="tab" aria-selected="false"><i class="ci-user me-2 mt-n1"></i>Restablecer contraseña</a></li>
                    </ul>
                    <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body tab-content py-4">

                    <div class="tab-pane fade show active" id="signin-tab">
                        <form method="post" id="signin-tab-form" class="needs-validation" autocomplete="off" data-parsley-validate>
                            <div class="mb-3">
                                <label class="form-label" for="si-email">Correo electrónico <sup class="redstar">*</sup></label>
                                <input class="form-control" type="email" name="email" id="si-email" placeholder="" required value="">
                                <div class="invalid-feedback">Por favor, rellene su correo electrónico</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="si-password">Contraseña: <sup class="redstar">*</sup></label>
                                <div class="password-toggle">
                                    <input class="form-control" type="password" name="heslo" id="si-password" required value="">
                                    <label class="password-toggle-btn" aria-label="Show/hide password">
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3 d-flex flex-wrap justify-content-between">
                                <div class="form-check mb-2">
                                </div>
                                <span role="tablist">
                                <a class="fs-sm" href="#" id="link_recovery">¿Ha olvidado su contraseña?</a>
                            </span>
                            </div>

                            <div class="invalid-feedback submit_error login_missingdata alert alert-danger" style="display: none">¡Datos incompletos en el formulario!</div>
                            <div class="invalid-feedback submit_error login_nameshort alert alert-danger" style="display: none">Nombre demasiado corto (mínimo 2 caracteres).</div>
                            <div class="invalid-feedback submit_error login_surnameshort alert alert-danger" style="display: none">Apellido demasiado corto (mínimo 2 caracteres).</div>
                            <div class="invalid-feedback submit_error login_invalidemail alert alert-danger" style="display: none">Añadir dirección de entrega</div>
                            <div class="invalid-feedback submit_error login_shortpwd alert alert-danger" style="display: none">Contraseña demasiado corta (mínimo 6 caracteres).</div>
                            <div class="invalid-feedback submit_error login_invalid_credentials alert alert-danger" style="display: none">Datos de acceso no válidos.</div>

                            <div>
                                <button class="btn btn-primary btn-shadow d-block w-100" type="submit" id="login_button">Entrar en el sistema</button>
                            </div>
                        </form>
                    </div>


                    <div class="tab-pane fade" id="signup-tab">
                        <form method="post" id="signup-tab-form" class="row needs-validation" autocomplete="off" data-parsley-validate>

                            <div class="mb-3">
                                <label class="form-label" for="su-email">Correo electrónico <sup class="redstar">*</sup></label>
                                <input
                                        class="form-control"
                                        type="email"
                                        name="email"
                                        id="su-email"
                                        placeholder=""
                                        required
                                        data-parsley-type="email"
                                        data-parsley-trigger="focusout"
                                        data-parsley-checkemail
                                        value=""
                                >
                                <div class="invalid-feedback" id="email-error"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="su-password">Contraseña (longitud mínima de 6 caracteres) <sup class="redstar">*</sup></label>
                                <div class="password-toggle">
                                    <input
                                            class="form-control"
                                            name="heslo"
                                            type="password"
                                            id="su-password"
                                            required
                                            value=""
                                            minlength="6"
                                            data-parsley-minlength="6"
                                            data-parsley-trigger="focusout"
                                            data-parsley-error-message="Neplatné heslo"
                                    >
                                    <div class="invalid-feedback">Por favor, introduzca su dirección de correo electrónico</div>
                                    <label class="password-toggle-btn" aria-label="Show/hide password">
                                    </label>
                                </div>
                            </div>



                            <div class="invalid-feedback submit_error missingdata" style="display: none">¡Datos incompletos en el formulario!</div>
                            <div class="invalid-feedback submit_error invalidemail" style="display: none">Correo electrónico no válido</div>
                            <div class="invalid-feedback submit_error shortpwd" style="display: none">Contraseña demasiado corta (mínimo 6 caracteres).</div>
                            <div class="invalid-feedback submit_error existingemail" style="display: none">El correo electrónico ya existe</div>

                            <div>
                            <button class="btn btn-primary btn-shadow d-block w-100" id="submit_reg" type="submit">Registrarse</button>
                            </div>

                        </form>
                    </div>

                    <div class="tab-pane fade" id="recover-tab">
                        <form action="/api/v1/recovery" method="post" class="row needs-validation" autocomplete="off" data-parsley-validate="">

                            <div class="mb-3">
                                <label class="form-label" for="sr-email">Correo electrónico <sup class="redstar">*</sup></label>
                                <input class="form-control" type="email" name="email" id="sr-email" placeholder="" required value="">
                                <div class="invalid-feedback">Por favor, rellene su correo electrónico</div>
                            </div>

                            <div class="mb-3">
                                Después de introducir su correo electrónico, le enviaremos automáticamente un enlace de acceso único a su buzón de correo electrónico.                            </div>

                            <div>
                                <button class="btn btn-primary btn-shadow d-block w-100" type="submit">Enviar enlace de acceso</button>
                            </div>

                        </form>
                    </div>

                </div>

        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        // Function to get URL parameter value
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
        
        // Check for existing new_reg parameter
        if (window.location.search.includes('?new_reg')) {
            // Otevře modální okno
            $('#signin-modal').modal('show');

            // Aktivuje registrační záložku
            $('#tab_reg').tab('show');
            // nebo alternativně pomocí Bootstrap 5 syntaxe:
            // new bootstrap.Tab($('#tab_reg')).show();
        }
        
        // Check for new registration feature with email parameter
        var regParam = getUrlParameter('reg');
        var emailParam = getUrlParameter('email');
        
        if (regParam === '1' && emailParam !== '') {
            // Otevře modální okno
            $('#signin-modal').modal('show');
            
            // Aktivuje registrační záložku
            $('#tab_reg').tab('show');
            
            // Pre-fill email field in registration form
            $('#su-email').val(emailParam);
            
            // Also pre-fill login form email field in case user switches tabs
            $('#si-email').val(emailParam);
            
            // Also pre-fill recovery form email field in case user switches tabs
            $('#sr-email').val(emailParam);
        }
    });
</script>
        <script src="/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/vendor/tiny-slider/dist/min/tiny-slider.js"></script>
        <script async src="/vendor/drift-zoom/dist/Drift.min.js"></script>
    <script src="/vendor/lightgallery.js/dist/js/lightgallery.min.js"></script>
        <script src="/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
    <script async src="/js/theme.js"></script>
    <script src="/js/parsley/parsley.min.js"></script>
    <script src="/js/parsley/i18n/es.js"></script>
    <!--<script async src="/js/parsley/parsley.custom.js"></script>-->
    <script>
        const emailErrorMessage = 'Dicho correo electrónico ya existe. Intente iniciar sesión.';
    </script>
    <script src="/js/custom.js?t=4"></script>
    
<style>
    /* Legacy Autocomplete Compatibility Styles */
    .autocomplete-items .row {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }

    .ac_img {
        text-align: center;
    }

    .ac_img img {
        height: 80px !important;
        width: auto;
        max-width: 100%;
        display: block;
        margin: 0 auto;
    }

    .ac_title {
        text-align: left;
        font-size: 14px;
        line-height: 1.3;
        color: black !important;
    }

    .ac_title a {
        color: black !important;
        font-weight: 500;
        text-decoration: none;
    }

    .ac_price {
        color: black !important;
        font-weight: bold;
        font-size: 14px;
        margin-top: 5px;
        display: inline-block;
    }

    .ac_stock {
        font-size: 12px;
        margin-top: 2px;
        display: inline-block;
    }

    .ac_add {
        text-align: left;
    }

    .ac_add .btn {
        white-space: nowrap;
    }

    @media (max-width: 600px) {
        .autocomplete-items .col-2 {
            flex: 0 0 20%;
            max-width: 20%;
        }
        .autocomplete-items .col-6 {
            flex: 0 0 60%;
            max-width: 60%;
        }
        .autocomplete-items .col-4 {
            flex: 0 0 20%;
            max-width: 20%;
            text-align: left;
        }
    }

    /* Modern Autocomplete Styles */
    
    /* Hide original search icon only in desktop search input */
    .autocomplete .ci-search {
        display: none !important;
    }
    
    /* Override existing search input styles for modern look */
    .search-container input[type="text"],
    #searchbox,
    #search_input {
        padding: 15px 50px 15px 20px !important;
        border: 2px solid #e0e0e0 !important;
        border-radius: 25px !important;
        font-size: 16px !important;
        outline: none !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
    }

    .search-container input[type="text"]:focus,
    #searchbox:focus,
    #search_input:focus,
    .modern-search-wrapper input:focus {
        border-color: #2196F3 !important;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.3), 0 4px 12px rgba(33, 150, 243, 0.2) !important;
        background: white !important;
        transform: scale(1.02) !important;
    }

    /* Ensure focused state is visible */
    .modern-search-wrapper.focused input {
        border-color: #2196F3 !important;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.3), 0 4px 12px rgba(33, 150, 243, 0.2) !important;
        transform: scale(1.02) !important;
    }
    
    /* Keep search box highlighted when dropdown is active */
    .modern-search-wrapper.dropdown-active input {
        border-color: #2196F3 !important;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.3), 0 4px 12px rgba(33, 150, 243, 0.2) !important;
        transform: scale(1.02) !important;
    }
    
    /* Ensure search wrapper has proper z-index */
    .modern-search-wrapper {
        position: relative !important;
        z-index: 1040 !important;
    }

    /* Modern autocomplete dropdown */
    .modern-autocomplete-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: 20px !important;
        box-shadow: 0 8px 32px rgba(0,0,0,0.15);
        margin-top: 8px;
        z-index: 1035;
        display: none;
        max-height: calc(100vh - 120px);
        overflow-y: auto;
        overflow-x: hidden;
    }

    /* Desktop scrolling */
    @media (min-width: 769px) {
        .modern-dropdown-content {
            max-height: calc(100vh - 160px);
            overflow-y: auto;
        }
    }

    /* Mobile fullscreen overlay */
    @media (max-width: 768px) {
        .modern-autocomplete-dropdown {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            max-height: 100vh !important;
            z-index: 1045 !important;
            overflow: visible !important;
        }

        .modern-dropdown-content {
            padding-top: 85px;
            padding-bottom: 120px; /* Ještě více místa pro sticky footer */
            max-height: 100vh;
            overflow-y: auto;
            box-sizing: border-box;
        }
        
        /* Mobilní sticky footer - jen když je dropdown otevřený */
        .modern-autocomplete-dropdown.show .modern-show-all-btn {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 100000 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1) !important;
            padding: 12px 20px !important; /* Menší vertical padding */
        }
        
        /* Mobilní close button nad sticky footer */
        .modern-mobile-close-inline {
            z-index: 100001 !important;
        }
        
        /* Ensure quantity display is visible on mobile */
        .modern-quantity-display {
            color: #333 !important;
            background: rgba(255, 255, 255, 0.95) !important;
            border: 1px solid #e0e0e0 !important;
            min-width: 24px !important;
            font-weight: 600 !important;
        }
        
        /* Make quantity buttons bigger and more touchable on mobile */
        .modern-quantity-btn {
            width: 36px !important;
            height: 36px !important;
            font-size: 16px !important;
            font-weight: bold !important;
            min-width: 36px !important;
            min-height: 36px !important;
            touch-action: manipulation !important;
            -webkit-tap-highlight-color: transparent !important;
            z-index: 10 !important;
            position: relative !important;
            pointer-events: auto !important;
            user-select: none !important;
            -webkit-user-select: none !important;
        }
        
        /* Ensure buttons have proper spacing on mobile */
        .modern-quantity-controls {
            gap: 8px !important;
            pointer-events: auto !important;
            position: relative !important;
            z-index: 5 !important;
        }
        
        /* Ensure cart container doesn't interfere with touch events */
        .modern-product-cart {
            pointer-events: auto !important;
            position: relative !important;
        }

        .modern-mobile-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            z-index: 100000;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .modern-mobile-search {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 16px;
        }

        .modern-mobile-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
        }
    }

    /* Section headers */
    .modern-section-header {
        padding: 15px 20px 10px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 1px solid #f0f0f0;
        background: #fafafa;
    }

    /* Product items */
    .modern-product-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        cursor: pointer;
        transition: background 0.2s;
        border-bottom: 1px solid #f5f5f5;
        touch-action: manipulation;
        user-select: none;
        -webkit-user-select: none;
    }

    .modern-product-item:hover {
        background: #f8f9fa;
    }
    
    /* Reduce hover effects on mobile to avoid accidental activation */
    @media (max-width: 768px) {
        .modern-product-item:hover {
            background: inherit;
        }
        
        .modern-product-item:active {
            background: #f0f0f0;
        }
    }

    .modern-product-image {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 15px;
        background: #f0f0f0;
    }

    .modern-product-info {
        flex: 1;
    }

    .modern-product-name {
        font-size: 14px;
        color: #333;
        line-height: 1.4;
        margin-bottom: 4px;
    }

    .modern-product-price {
        font-size: 16px;
        font-weight: 600;
        color: #007bff;
    }

    .modern-product-availability {
        font-size: 12px;
        color: #4caf50;
        margin-top: 2px;
    }

    .modern-product-availability.out-of-stock {
        color: #ff9800;
    }

    /* Product info layout */
    .modern-product-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 6px;
        gap: 10px;
    }

    .modern-product-left {
        flex: 1;
    }

    .modern-product-right {
        flex-shrink: 0;
    }

    /* Cart controls */
    .modern-product-cart {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .modern-add-to-cart-btn {
        background: #469759;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
        white-space: nowrap;
        min-width: 70px;
    }

    .modern-add-to-cart-btn:hover {
        background: #3a7d4a;
    }

    .modern-add-to-cart-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    .modern-quantity-controls {
        display: none;
        align-items: center;
        gap: 3px;
    }

    .modern-quantity-controls.show {
        display: flex;
    }

    .modern-quantity-btn {
        width: 20px;
        height: 20px;
        background: #469759;
        color: white;
        border: none;
        border-radius: 2px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
    }

    .modern-quantity-btn:hover {
        background: #3a7d4a;
    }

    .modern-quantity-display {
        min-width: 20px;
        text-align: center;
        font-size: 11px;
        font-weight: 500;
        padding: 0 3px;
        color: #333 !important;
        background: rgba(255, 255, 255, 0.9) !important;
        border-radius: 2px;
    }

    /* Loading animation for dots */
    @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0.3; }
    }

    /* Category items */
    .modern-category-item {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        cursor: pointer;
        transition: background 0.2s;
        border-bottom: 1px solid #f5f5f5;
    }

    .modern-category-item:hover {
        background: #f8f9fa;
    }

    .modern-category-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
    }
    
    .modern-category-icon svg {
        width: 20px;
        height: 20px;
        fill: #FFC107;
    }
    
    /* Header icons in section titles */
    .modern-section-header .header-icon {
        width: 16px;
        height: 16px;
        fill: #FFC107;
        margin-right: 8px;
        vertical-align: middle;
    }
    
    /* Mobile close button in content */
    .modern-mobile-close-inline {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        font-size: 24px;
        color: #666;
        cursor: pointer;
        z-index: 10001;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(255,255,255,0.9);
    }
    
    @media (min-width: 769px) {
        .modern-mobile-close-inline {
            display: none;
        }
    }

    .modern-category-name {
        flex: 1;
        font-size: 14px;
        color: #333;
    }

    /* Brand items */
    .modern-brand-item {
        display: inline-block;
        padding: 6px 12px;
        margin: 3px;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 12px;
        color: #333;
        white-space: nowrap;
    }

    .modern-brand-item:hover {
        background: #f0f8ff;
        border-color: #2196F3;
        color: #2196F3;
    }

    .modern-brands-grid {
        padding: 10px 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 3px;
        justify-content: flex-start;
        align-items: center;
    }

    /* Show all results button */
    .modern-show-all-btn {
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        background: #469759;
        color: white;
        border: none;
        padding: 18px 20px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: background 0.2s;
        text-align: center;
        box-sizing: border-box;
    }

    .modern-show-all-btn:hover {
        background: #3a7d4a;
    }

    .modern-show-all-btn .icon {
        font-size: 18px;
    }

    /* Loading state */
    .modern-loading {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    .modern-loading::after {
        content: '';
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #ddd;
        border-radius: 50%;
        border-top-color: #2196F3;
        animation: modern-spin 1s ease-in-out infinite;
        margin-left: 10px;
    }

    @keyframes modern-spin {
        to { transform: rotate(360deg); }
    }

    /* No results */
    .modern-no-results {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }

    /* Quick suggestions */
    .modern-quick-suggestions {
        padding: 15px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }

    .modern-quick-suggestions-title {
        font-size: 12px;
        color: #666;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .modern-quick-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .modern-quick-tag {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 15px;
        padding: 6px 12px;
        font-size: 13px;
        color: #333;
        cursor: pointer;
        transition: all 0.2s;
    }

    .modern-quick-tag:hover {
        background: #e3f2fd;
        border-color: #2196F3;
        color: #2196F3;
    }

    /* Show dropdown */
    .modern-autocomplete-dropdown.show {
        display: block !important;
    }
    
    /* Mobile fullscreen when shown */
    @media (max-width: 768px) {
        .modern-autocomplete-dropdown.show {
            display: block !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 1045 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            max-height: 100vh !important;
            width: 100vw !important;
            height: 100vh !important;
            background: white !important;
            overflow-y: auto !important;
        }
    }

    /* Clear button */
    .modern-clear-btn {
        position: absolute;
        right: 45px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        font-size: 18px;
        color: #999;
        cursor: pointer;
        display: none;
        z-index: 10;
    }

    /* Search icon */
    .modern-search-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
        font-size: 18px;
        z-index: 10;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Find the main search input on the page
    const searchInput = document.querySelector('#searchbox') || 
                       document.querySelector('input[name="searchbox"]') || 
                       document.querySelector('#search_input') || 
                       document.querySelector('input[name="search"]') || 
                       document.querySelector('.search-input') ||
                       document.querySelector('input[type="search"]');
                       
    // Also find mobile search input
    const mobileSearchInput = document.querySelector('#searchbox_mobile');
    
    if (!searchInput) {
        console.log('❌ Search input not found for modern autocomplete');
        console.log('Available inputs:', document.querySelectorAll('input'));
        return;
    }

    console.log('✅ Found search input:', searchInput);
    console.log('✅ Initializing modern autocomplete...');

    // Initialize modern autocomplete
    try {
        window.modernAutocomplete = new ModernAutocompleteIntegrated(searchInput);
        console.log('✅ Modern autocomplete initialized successfully');
    } catch (error) {
        console.error('❌ Error initializing modern autocomplete:', error);
    }
    
    // Initialize for mobile search input if it exists - use the same instance as desktop
    if (mobileSearchInput && window.modernAutocomplete) {
        console.log('✅ Found mobile search input - using existing autocomplete instance');
        // The existing autocomplete instance already handles mobile input
        // No need to create a second instance that would duplicate event listeners
    }
});

class ModernAutocompleteIntegrated {
    constructor(searchInput) {
        console.log('🔧 ModernAutocompleteIntegrated constructor called');
        this.searchInput = searchInput;
        this.currentQuery = '';
        this.searchTimeout = null;
        this.isMobile = window.innerWidth <= 768;
        console.log('📱 Mobile detection: window.innerWidth =', window.innerWidth, 'isMobile =', this.isMobile);
        
        // Touch tracking for distinguishing clicks from scrolls
        this.touchStartX = 0;
        this.touchStartY = 0;
        this.touchStartTime = 0;
        
        // Currency formatting settings
        this.currencySymbol = '€';
        this.rounding = 2;
        
        console.log('💰 Currency settings from PHP:', {
            symbol: '€',
            symbolLength: '3',
            rounding: 2,
            domain: 'ferwer.es',
            currency: 'EUR',
            finalSymbol: this.currencySymbol,
            finalRounding: this.rounding
        });
        this.dropdown = null;
        this.mobileHeader = null;
        this.mobileSearch = null;
        
        console.log('🔧 Starting init...');
        this.init();
        console.log('🔧 Starting event listeners...');
        this.setupEventListeners();
        console.log('🔧 Constructor finished');
    }
    
    // Format price according to currency settings
    formatPrice(price) {
        console.log('💰 formatPrice called with:', price, 'type:', typeof price, 'rounding:', this.rounding, 'symbol:', this.currencySymbol);
        
        if (price === null || price === undefined || price === '') {
            console.log('❌ Invalid price:', price);
            return 'N/A';
        }
        
        // Handle Czech comma decimal separator in strings
        let numPrice;
        if (typeof price === 'string') {
            // Remove spaces and replace Czech comma with dot for parsing
            const normalizedPrice = price.replace(/\s/g, '').replace(',', '.');
            numPrice = parseFloat(normalizedPrice);
            console.log('🔄 Converted string price:', price, '→', normalizedPrice, '→', numPrice);
        } else {
            numPrice = Number(price);
        }
        
        if (isNaN(numPrice)) {
            console.log('❌ Cannot convert to number:', price);
            return 'N/A';
        }
        
        // Smart fallback based on domain
        let symbol = this.currencySymbol;
        if (!symbol) {
            const domain = window.location.hostname;
            if (domain.includes('.de') || domain.includes('.at') || domain.includes('.fr') || 
                domain.includes('.it') || domain.includes('.es') || domain.includes('.nl') ||
                domain.includes('.be') || domain.includes('.hu') || domain.includes('.ro') ||
                domain.includes('.sk') || domain.includes('.bg') || domain.includes('.pt') ||
                domain.includes('.si') || domain.includes('.se') || domain.includes('.ch') ||
                domain.includes('.dk') || domain.includes('.com')) {
                symbol = '€';
            } else if (domain.includes('.pl')) {
                symbol = 'zł';
            } else {
                symbol = 'Kč'; // Czech default
            }
            console.log('🌍 Domain-based symbol fallback:', domain, '→', symbol);
        }
        const formatted = numPrice.toLocaleString('cs-CZ', {
            minimumFractionDigits: this.rounding,
            maximumFractionDigits: this.rounding
        }).replace(/\s/g, ' ') + ' ' + symbol;
        
        console.log('✅ Formatted price:', formatted);
        return formatted;
    }
    
    init() {
        // Wrap search input in container for positioning
        if (!this.searchInput.parentElement.classList.contains('modern-search-wrapper')) {
            const wrapper = document.createElement('div');
            wrapper.className = 'modern-search-wrapper';
            wrapper.style.position = 'relative';
            wrapper.style.display = 'inline-block';
            wrapper.style.width = '100%';
            
            this.searchInput.parentElement.insertBefore(wrapper, this.searchInput);
            wrapper.appendChild(this.searchInput);
            
            // Add clear button and search icon
            const clearBtn = document.createElement('button');
            clearBtn.className = 'modern-clear-btn';
            clearBtn.innerHTML = '×';
            clearBtn.id = 'modernClearBtn';
            
            const searchIcon = document.createElement('div');
            searchIcon.className = 'modern-search-icon';
            searchIcon.innerHTML = '🔍';
            
            wrapper.appendChild(clearBtn);
            wrapper.appendChild(searchIcon);
            
            this.clearBtn = clearBtn;
        }
        
        // Create dropdown
        this.createDropdown();
        
        // Handle resize
        window.addEventListener('resize', () => {
            this.isMobile = window.innerWidth <= 768;
        console.log('📱 Mobile detection: window.innerWidth =', window.innerWidth, 'isMobile =', this.isMobile);
            this.updateMobileHeader();
        });
        this.updateMobileHeader();
    }
    
    createDropdown() {
        this.dropdown = document.createElement('div');
        this.dropdown.className = 'modern-autocomplete-dropdown';
        this.dropdown.id = 'modernAutocompleteDropdown';
        console.log('🔨 Created dropdown element:', this.dropdown);
        
        // Mobile header
        this.mobileHeader = document.createElement('div');
        this.mobileHeader.className = 'modern-mobile-header';
        this.mobileHeader.style.display = 'none';
        
        this.mobileSearch = document.createElement('input');
        this.mobileSearch.className = 'modern-mobile-search';
        this.mobileSearch.placeholder = 'Buscar...';
        
        const mobileClose = document.createElement('button');
        mobileClose.className = 'modern-mobile-close';
        mobileClose.innerHTML = '×';
        
        this.mobileHeader.appendChild(this.mobileSearch);
        this.mobileHeader.appendChild(mobileClose);
        
        // Content container
        const content = document.createElement('div');
        content.className = 'modern-dropdown-content';
        content.id = 'modernDropdownContent';
        
        // Add inline close button for mobile
        const inlineCloseBtn = document.createElement('button');
        inlineCloseBtn.className = 'modern-mobile-close-inline';
        inlineCloseBtn.innerHTML = '×';
        inlineCloseBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('🔴 Inline close button clicked');
            this.hideDropdown();
        });
        content.appendChild(inlineCloseBtn);
        
        // Quick suggestions (empty by default)
        const quickSuggestions = document.createElement('div');
        quickSuggestions.className = 'modern-quick-suggestions';
        quickSuggestions.id = 'modernQuickSuggestions';
        quickSuggestions.style.display = 'none'; // Hidden by default
        
        // Results container
        const resultsContainer = document.createElement('div');
        resultsContainer.id = 'modernResultsContainer';
        
        content.appendChild(quickSuggestions);
        content.appendChild(resultsContainer);
        
        this.dropdown.appendChild(this.mobileHeader);
        this.dropdown.appendChild(content);
        
        // Insert dropdown after search input wrapper
        this.searchInput.parentElement.parentElement.insertBefore(this.dropdown, this.searchInput.parentElement.nextSibling);
        console.log('📎 Dropdown inserted into DOM');
        console.log('📎 Dropdown parent after insertion:', this.dropdown.parentElement);
        console.log('📎 Dropdown visibility:', getComputedStyle(this.dropdown).display);
        
        this.quickSuggestions = quickSuggestions;
        this.resultsContainer = resultsContainer;
        this.mobileClose = mobileClose;
    }
    
    setupEventListeners() {
        console.log('🔧 Setting up event listeners...');
        
        // Prevent multiple event listener registration
        if (this.eventListenersSetup) {
            console.log('⚠️ Event listeners already setup, skipping...');
            return;
        }
        this.eventListenersSetup = true;
        
        // Main search input
        this.searchInput.addEventListener('input', (e) => {
            this.handleInput(e.target.value);
        });
        
        // Handle Enter key for search submission
        this.searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.keyCode === 13) {
                e.preventDefault();
                const query = this.searchInput.value.trim();
                if (query) {
                    console.log('🔍 Enter pressed, searching for:', query);
                    window.location.href = `/search?searchbox=${encodeURIComponent(query)}`;
                }
            }
        });
        
        this.lastFocusTime = 0;
        
        this.searchInput.addEventListener('focus', () => {
            console.log('🎯 Search input focused');
            this.searchInput.parentElement.classList.add('focused');
            this.lastFocusTime = Date.now();
            this.handleFocusOrClick();
        });
        
        this.searchInput.addEventListener('click', () => {
            console.log('🖱️ Search input clicked');
            // Prevent duplicate call if focus just happened
            if (Date.now() - this.lastFocusTime > 100) {
                this.handleFocusOrClick();
            } else {
                console.log('🚫 Skipping click - focus just happened');
            }
        });
        
        this.searchInput.addEventListener('blur', () => {
            setTimeout(() => {
                this.searchInput.parentElement.classList.remove('focused');
            }, 200);
        });
        
        // Mobile search sync
        this.mobileSearch.addEventListener('input', (e) => {
            console.log('📱 Mobile search input:', e.target.value);
            this.searchInput.value = e.target.value;
            this.handleInput(e.target.value);
        });
        
        // Handle Enter key for mobile search
        this.mobileSearch.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.keyCode === 13) {
                e.preventDefault();
                const query = this.mobileSearch.value.trim();
                if (query) {
                    console.log('📱🔍 Mobile Enter pressed, searching for:', query);
                    window.location.href = `/search?searchbox=${encodeURIComponent(query)}`;
                }
            }
        });
        
        // Mobile search focus/click
        this.mobileSearch.addEventListener('focus', () => {
            console.log('📱 Mobile search focused');
            this.handleFocusOrClick();
        });
        
        this.mobileSearch.addEventListener('click', () => {
            console.log('📱 Mobile search clicked');
            if (Date.now() - this.lastFocusTime > 100) {
                this.handleFocusOrClick();
            }
        });
        
        // Also listen to original mobile search input
        const originalMobileSearch = document.querySelector('#searchbox_mobile');
        if (originalMobileSearch) {
            console.log('✅ Found original mobile search input');
            
            originalMobileSearch.addEventListener('input', (e) => {
                console.log('📱 Original mobile search input:', e.target.value);
                // Keep dropdown open when typing - FORCE IT!
                if (this.dropdown.classList.contains('show')) {
                    console.log('📱 FORCE keeping dropdown open while typing');
                    e.stopPropagation();
                    e.preventDefault(); // Prevent any default behavior
                    
                    // Force show dropdown after input handling
                    setTimeout(() => {
                        if (!this.dropdown.classList.contains('show')) {
                            console.log('📱 Dropdown was closed, forcing it back open!');
                            this.showDropdown();
                        }
                    }, 10);
                }
                this.handleInput(e.target.value);
            });
            
            originalMobileSearch.addEventListener('focus', () => {
                console.log('📱 Original mobile search focused');
                this.handleFocusOrClick();
            });
            
            // Handle Enter key for original mobile search
            originalMobileSearch.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.keyCode === 13) {
                    e.preventDefault();
                    const query = originalMobileSearch.value.trim();
                    if (query) {
                        console.log('📱🔍 Original mobile Enter pressed, searching for:', query);
                        window.location.href = `/search?searchbox=${encodeURIComponent(query)}`;
                    }
                }
            });
        }
        
        // Clear button
        this.clearBtn.addEventListener('click', () => {
            this.clearSearch();
        });
        
        // Mobile close
        this.mobileClose.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('🔴 My mobile close clicked');
            this.hideDropdown();
        });
        
        // Global click handler for cart actions and close buttons
        this.globalClickHandler = (e) => {
            // Reduced debugging for touch events
            if (e.type === 'touchend' && e.target.dataset.action) {
                console.log('📱 Touch action:', e.target.dataset.action, e.target.dataset.productId);
            }
            
            // Handle add to cart buttons
            if (e.target.matches('[data-action="add-to-cart"]')) {
                e.preventDefault();
                e.stopPropagation();
                const productId = e.target.dataset.productId;
                console.log('🛒 Add to cart clicked:', productId, 'event type:', e.type);
                this.addToCart(productId, e.target);
                return;
            }
            
            // Handle quantity change buttons
            if (e.target.matches('[data-action="quantity-change"]')) {
                e.preventDefault();
                e.stopPropagation();
                
                // Prevent rapid double-taps on mobile
                if (this.isMobile) {
                    const now = Date.now();
                    const lastTap = e.target._lastTap || 0;
                    if (now - lastTap < 300) {
                        console.log('🔢 Ignored rapid double-tap');
                        return;
                    }
                    e.target._lastTap = now;
                }
                
                const productId = e.target.dataset.productId;
                const delta = parseInt(e.target.dataset.delta);
                console.log('🔢 Quantity change clicked:', productId, delta, 'event type:', e.type);
                this.changeQuantity(productId, delta);
                return;
            }
            
            // Handle product clicks (navigate to product page) - but avoid false clicks from scrolling
            const productItem = e.target.closest('.modern-product-item[data-product-url]');
            if (productItem && !e.target.closest('.modern-product-cart')) {
                // Check if this is a real click or just scroll/touch movement
                if (this.isRealClick(e)) {
                    e.preventDefault();
                    e.stopPropagation();
                    const productUrl = productItem.dataset.productUrl;
                    console.log('🔗 Product clicked, navigating to:', productUrl);
                    window.location.href = productUrl;
                    return;
                } else {
                    console.log('🚫 Ignoring scroll/movement as click');
                    return;
                }
            }
            
            // Check if clicked element is a close button (×, X, close)
            const element = e.target;
            const text = element.textContent?.trim();
            const isCloseButton = text === '×' || text === 'X' || text === 'x' || 
                                 element.classList.contains('close') ||
                                 element.classList.contains('btn-close') ||
                                 element.getAttribute('aria-label')?.includes('Close');
            
            if (isCloseButton && this.dropdown.classList.contains('show')) {
                console.log('🔴 Other close button clicked:', element);
                e.preventDefault();
                e.stopPropagation();
                this.hideDropdown();
            }
        };
        
        // Remove any existing global click handler first
        if (window.modernAutocompleteGlobalHandler) {
            document.removeEventListener('click', window.modernAutocompleteGlobalHandler);
            document.removeEventListener('touchend', window.modernAutocompleteGlobalHandler);
        }
        
        // Add new global click handler
        if (this.isMobile) {
            // For mobile, use ONLY touchend to avoid double events
            document.addEventListener('touchend', this.globalClickHandler, { passive: false });
            console.log('📱 Mobile: Using only touchend events');
        } else {
            // For desktop, use click events
            document.addEventListener('click', this.globalClickHandler);
            console.log('🖥️ Desktop: Using click events');
        }
        window.modernAutocompleteGlobalHandler = this.globalClickHandler;
        
        // Setup touch tracking to distinguish clicks from scrolls
        this.setupTouchTracking();
        
        // Quick suggestions
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modern-quick-tag')) {
                const query = e.target.dataset.query;
                this.searchInput.value = query;
                this.mobileSearch.value = query;
                this.handleInput(query);
            }
        });
        
        // Click outside to close
        document.addEventListener('click', (e) => {
            const clickedInSearchInput = this.searchInput.contains(e.target);
            const clickedInDropdown = this.dropdown.contains(e.target);
            const clickedInMobileSearch = document.querySelector('#searchbox_mobile')?.contains(e.target);
            
            if (!clickedInSearchInput && !clickedInDropdown && !clickedInMobileSearch) {
                this.hideDropdown();
            }
        });
        
        // Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.hideDropdown();
            }
        });
        
        // Connect original mobile search icon to our autocomplete
        // Try both immediate and delayed search for mobile buttons
        this.setupMobileSearchListeners();
    }
    

    
    setupTouchTracking() {
        console.log('📱 Setting up touch tracking for click vs scroll detection...');
        
        // Track touch start position and time
        document.addEventListener('touchstart', (e) => {
            if (e.touches && e.touches.length > 0) {
                this.touchStartX = e.touches[0].clientX;
                this.touchStartY = e.touches[0].clientY;
                this.touchStartTime = Date.now();
            }
        }, { passive: true });
    }
    
    isRealClick(e) {
        // For mouse events, always consider real clicks
        if (e.type === 'click' && !this.isMobile) {
            return true;
        }
        
        // For touch events, check if movement was minimal and duration was short
        if (e.type === 'touchend' || e.type === 'touchstart') {
            const touchEndTime = Date.now();
            const duration = touchEndTime - this.touchStartTime;
            
            // Get touch end position
            let touchEndX = this.touchStartX;
            let touchEndY = this.touchStartY;
            
            if (e.changedTouches && e.changedTouches.length > 0) {
                touchEndX = e.changedTouches[0].clientX;
                touchEndY = e.changedTouches[0].clientY;
            }
            
            // Calculate movement distance
            const deltaX = Math.abs(touchEndX - this.touchStartX);
            const deltaY = Math.abs(touchEndY - this.touchStartY);
            const totalMovement = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            // Consider it a real click if:
            // - Duration is short (less than 500ms)
            // - Movement is minimal (less than 10px)
            const isQuick = duration < 500;
            const isMinimalMovement = totalMovement < 10;
            
            console.log('📱 Touch analysis:', {
                duration,
                totalMovement,
                isQuick,
                isMinimalMovement,
                isRealClick: isQuick && isMinimalMovement
            });
            
            return isQuick && isMinimalMovement;
        }
        
        // For regular click events, assume they're real
        return true;
    }
    
    setupMobileSearchListeners() {
        const trySetupListeners = () => {
            // Primary: Look for our new mobile search triggers
            const mobileSearchTriggers = document.querySelectorAll('.mobile-search-trigger, .mobile-search-trigger-header');
            console.log('🔍 Found mobile search triggers:', mobileSearchTriggers.length);
            
            const mobileSearchButtons = document.querySelectorAll('.navbar-toggler .ci-search');
            console.log('🔍 Found mobile search buttons:', mobileSearchButtons.length);
            
            // Also try alternative selectors
            const altMobileButtons = document.querySelectorAll('.ci-search');
            console.log('🔍 Found all .ci-search buttons:', altMobileButtons.length);
            
            // Handle new mobile search triggers
            mobileSearchTriggers.forEach(trigger => {
                console.log('📱 Setting up listener for mobile search trigger:', trigger.className);
                trigger.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('📱 Mobile search trigger clicked:', trigger.className);
                    
                    if (this.isMobile) {
                        this.showTopSuggestions();
                        // Focus the actual mobile search input that's visible
                        const visibleMobileInput = document.querySelector('#searchbox_mobile');
                        if (visibleMobileInput) {
                            console.log('📱 Focusing real mobile input #searchbox_mobile');
                            setTimeout(() => {
                                visibleMobileInput.focus();
                                visibleMobileInput.click(); // Also trigger click to ensure focus
                            }, 100);
                        } else {
                            console.log('📱 Focusing created mobile input');
                            setTimeout(() => {
                                this.mobileSearch.focus();
                            }, 100);
                        }
                    } else {
                        this.searchInput.focus();
                        this.handleFocusOrClick();
                    }
                });
            });
            
            mobileSearchButtons.forEach(button => {
                console.log('📱 Setting up listener for mobile search button:', button);
                button.parentElement.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('📱 Original mobile search icon clicked');
                    
                    // Focus our mobile search input and show top suggestions
                    if (this.isMobile) {
                        this.showTopSuggestions();
                        // Focus the actual mobile search input that's visible
                        const visibleMobileInput = document.querySelector('#searchbox_mobile');
                        if (visibleMobileInput) {
                            console.log('📱 Focusing real mobile input #searchbox_mobile');
                            setTimeout(() => {
                                visibleMobileInput.focus();
                                visibleMobileInput.click(); // Also trigger click to ensure focus
                            }, 100);
                        } else {
                            console.log('📱 Focusing created mobile input');
                            setTimeout(() => {
                                this.mobileSearch.focus();
                            }, 100);
                        }
                    } else {
                        // On desktop, focus main search input
                        this.searchInput.focus();
                        this.handleFocusOrClick();
                    }
                });
            });
            
            // Universal fallback: Listen to ALL .ci-search icons that are NOT in autocomplete wrapper
            console.log('📱 Setting up universal fallback for .ci-search clicks');
            document.addEventListener('click', (e) => {
                // Check if clicked element or its parent has .ci-search class
                const clickedElement = e.target;
                const isSearchIcon = clickedElement.classList.contains('ci-search') || 
                                   clickedElement.closest('.ci-search') ||
                                   clickedElement.closest('.mobile-search-trigger') ||
                                   clickedElement.closest('.mobile-search-trigger-header');
                
                // Make sure it's NOT our autocomplete search icon
                const isInAutocomplete = clickedElement.closest('.autocomplete') || 
                                        clickedElement.closest('.modern-autocomplete-dropdown');
                
                if (isSearchIcon && !isInAutocomplete) {
                    console.log('📱 Universal: Mobile search icon clicked via document listener');
                    console.log('📱 Clicked element:', clickedElement);
                    console.log('📱 Is mobile:', this.isMobile);
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (this.isMobile) {
                        this.showTopSuggestions();
                        const visibleMobileInput = document.querySelector('#searchbox_mobile');
                        if (visibleMobileInput) {
                            console.log('📱 Universal: Focusing #searchbox_mobile');
                            setTimeout(() => {
                                visibleMobileInput.focus();
                                visibleMobileInput.click();
                            }, 100);
                        }
                    } else {
                        this.searchInput.focus();
                        this.handleFocusOrClick();
                    }
                }
            });
        };
        
        // Try immediately
        trySetupListeners();
        
        // Also try after a delay in case mobile navbar loads later
        setTimeout(trySetupListeners, 500);
        setTimeout(trySetupListeners, 1000);
    }
    
    updateMobileHeader() {
        console.log('📱 Mobile check: window.innerWidth =', window.innerWidth, 'isMobile =', this.isMobile);
        if (this.isMobile) {
            this.mobileHeader.style.display = 'flex';
            console.log('📱 Mobile header shown');
        } else {
            this.mobileHeader.style.display = 'none';
            console.log('🖥️ Mobile header hidden');
        }
    }
    
    handleFocusOrClick() {
        // Update currentQuery from input value
        this.currentQuery = this.searchInput.value.trim();
        console.log('🎯 handleFocusOrClick called, currentQuery:', this.currentQuery);
        
        if (this.currentQuery.length >= 2) {
            console.log('📝 Query exists, performing search');
            this.performSearch(this.currentQuery);
        } else {
            console.log('🌟 No query, showing top suggestions');
            this.showTopSuggestions();
        }
    }
    
    handleInput(value) {
        console.log('🔍 handleInput called with:', value);
        console.log('📱 Mobile mode:', this.isMobile, 'Dropdown shown:', this.dropdown.classList.contains('show'));
        this.currentQuery = value.trim();
        
        // Show/hide clear button
        if (value.length > 0) {
            this.clearBtn.style.display = 'block';
        } else {
            this.clearBtn.style.display = 'none';
        }
        
        // Clear previous timeout
        if (this.searchTimeout) {
            clearTimeout(this.searchTimeout);
        }
        
        if (this.currentQuery.length === 0) {
            this.showTopSuggestions();
            return;
        }
        
        // Mobile has more relaxed search criteria
        const minLength = this.isMobile ? 1 : 2;
        
        if (this.currentQuery.length < minLength) {
            // On mobile, show top suggestions instead of hiding dropdown
            if (this.isMobile && this.dropdown.classList.contains('show')) {
                console.log('📱 Short query on mobile - showing top suggestions instead of hiding');
                this.showTopSuggestions();
            } else {
                this.hideDropdown();
            }
            return;
        }
        
        // Debounce search
        this.searchTimeout = setTimeout(() => {
            this.performSearch(this.currentQuery);
        }, 200);
    }
    
    async performSearch(query) {
        this.showLoading();
        
        try {
            const response = await fetch(`/search9.php?whisper=1&t=${encodeURIComponent(query)}`);
            const data = await response.json();
            
            this.displayResults(data, query);
        } catch (error) {
            console.error('Search error:', error);
            this.showError();
        }
    }
    
    // Check if products are already in cart - SIMPLE API ONLY
    async checkCartStatus(productIds) {
        console.log('🛒 Checking cart status for products:', productIds);
        
        if (!productIds || productIds.length === 0) {
            console.log('🛒 No product IDs provided');
            return {};
        }
        
        try {
            const requestBody = { product_ids: productIds };
            console.log('🛒 Sending request to API:', requestBody);
            
            const response = await fetch('/api/check-cart-status.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });
            
            console.log('🛒 API response status:', response.status);
            
            if (response.ok) {
                const data = await response.json();
                console.log('🛒 Cart status from server:', data);
                console.log('🛒 Response type:', typeof data, 'Keys:', Object.keys(data || {}));
                
                // Debug each product
                if (data && typeof data === 'object') {
                    productIds.forEach(productId => {
                        const status = data[productId];
                        console.log(`🛒 Product ${productId}:`, status);
                    });
                }
                
                return data || {};
            } else {
                const errorText = await response.text();
                console.error('❌ Cart status API failed:', response.status, errorText);
                return {};
            }
        } catch (error) {
            console.error('❌ Cart status API error:', error);
            return {};
        }
    }
    

    
    async displayResults(data, query) {
        if (!data || data.length === 0) {
            this.showNoResults();
            return;
        }
        
        // Group results by type
        const products = data.filter(item => item.c === 1);
        const categories = data.filter(item => item.c === 2);
        const brands = data.filter(item => item.c === 3);
        
        // Check cart status for all products - ALWAYS get fresh data from server
        const productIds = products.map(p => p.id ? p.id.split('_')[0] : null).filter(Boolean);
        const cartStatus = await this.checkCartStatus(productIds);
        
        let html = '';
        
        // Products section FIRST - NEJVYŠŠÍ PRIORITA
        if (products.length > 0) {
            html += '<div class="modern-section-header">🛍️ Productos</div>';
            products.slice(0, 20).forEach(product => {
                console.log('🔍 Search product data:', product);
                const availability = product.s ? 'En stock' : 'Bajo pedido';
                const availabilityClass = product.s ? 'modern-product-availability' : 'modern-product-availability out-of-stock';
                
                // Check if product is in stock and has no variants (can add to cart)
                const canAddToCart = product.s && product.g !== 'y' && !product.v; // in stock, no garance, and no variants
                const productId = product.id ? product.id.split('_')[0] : null; // extract base ID
                
                // Check if product is already in cart
                const inCart = cartStatus[productId]?.inCart || false;
                const cartQuantity = cartStatus[productId]?.quantity || 1;
                const cartRowId = cartStatus[productId]?.rowId || productId;
                
                console.log(`🛒 SEARCH RESULT - Product ${productId}:`, {
                    inCart, 
                    cartQuantity, 
                    cartRowId,
                    cartStatus: cartStatus[productId],
                    willShowAddButton: !inCart && !product.v, // Don't show add button for products with variants
                    willShowQuantityControls: inCart
                });
                
                html += `
                    <div class="modern-product-item" data-product-url="${product.u}">
                        <img src="${product.i}" alt="${this.stripHtml(product.n)}" class="modern-product-image" 
                             onerror="this.src='/img/placeholder/placeholder-m.webp'">
                        <div class="modern-product-info">
                            <div class="modern-product-name">${product.n}</div>
                            <div class="modern-product-bottom">
                                <div class="modern-product-left">
                                    <div class="modern-product-price">
                                        ${product.op && product.op !== product.p ? `
                                            <span class="text-accent">${this.formatPrice(product.p)}</span><br>
                                            <del class="fs-sm text-muted">${this.formatPrice(product.op)}</del>
                                        ` : this.formatPrice(product.p)}
                                    </div>
                                    <div class="${availabilityClass}">${availability}</div>
                                </div>
                                ${canAddToCart && productId ? `
                                    <div class="modern-product-right">
                                        <div class="modern-product-cart">
                                            ${!inCart ? `
                                                <button class="modern-add-to-cart-btn" data-product-id="${productId}" data-action="add-to-cart">
                                                    <i class="ci-cart me-1"></i>Añadir al carrito                                                </button>
                                            ` : ''}
                                            <div class="modern-quantity-controls ${inCart ? 'show' : ''}" id="qty-search-${productId}" data-row-id="${cartRowId}">
                                                <button class="modern-quantity-btn" data-product-id="${productId}" data-action="quantity-change" data-delta="-1">-</button>
                                                <span class="modern-quantity-display" id="qty-display-search-${productId}">${cartQuantity}</span>
                                                <button class="modern-quantity-btn" data-product-id="${productId}" data-action="quantity-change" data-delta="1">+</button>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Categories section SECOND
        if (categories.length > 0) {
            html += '<div class="modern-section-header"><svg class="header-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.952,3.258,10.6,4.742a1,1,0,0,0,.67.258h4.616a1,1,0,0,1,1,1V7h-14V4a1,1,0,0,1,1-1h4.4A1,1,0,0,1,8.952,3.258ZM3,8H16.766a1,1,0,0,1,.993,1.11l-.777,7a1,1,0,0,1-.994.89H3.778a1,1,0,0,1-.994-.89l-.778-7A1,1,0,0,1,3,8Z" transform="translate(-2 -3)"></path></svg> Categorías</div>';
            categories.slice(0, 4).forEach(category => {
                html += `
                    <div class="modern-category-item" onclick="window.location='${category.u}'">
                        <div class="modern-category-icon">
                            <svg viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8.952,3.258,10.6,4.742a1,1,0,0,0,.67.258h4.616a1,1,0,0,1,1,1V7h-14V4a1,1,0,0,1,1-1h4.4A1,1,0,0,1,8.952,3.258ZM3,8H16.766a1,1,0,0,1,.993,1.11l-.777,7a1,1,0,0,1-.994.89H3.778a1,1,0,0,1-.994-.89l-.778-7A1,1,0,0,1,3,8Z" transform="translate(-2 -3)"></path>
                            </svg>
                        </div>
                        <div class="modern-category-name">${category.n}</div>
                    </div>
                `;
            });
        }
        
        // Brands section THIRD
        if (brands.length > 0) {
            html += '<div class="modern-section-header">🏷️ Marcas</div>';
            html += '<div class="modern-brands-grid">';
            brands.slice(0, 8).forEach(brand => {
                html += `
                    <span class="modern-brand-item" onclick="window.location='${brand.u}'">${this.stripHtml(brand.n)}</span>
                `;
            });
            html += '</div>';
        }
        
        // Show all results button
        html += `
            <button class="modern-show-all-btn" onclick="window.location='/search?searchbox=${encodeURIComponent(query)}'">
                <span class="icon">🔍</span>
                <span>Mostrar todos los resultados</span>
            </button>
        `;
        
        this.resultsContainer.innerHTML = html;
        this.showDropdown();
    }
    
    showQuickSuggestions() {
        this.resultsContainer.innerHTML = '';
        this.quickSuggestions.style.display = 'block';
        this.showDropdown();
    }
    
    showNoTopSuggestions() {
        this.quickSuggestions.style.display = 'none';
        this.resultsContainer.innerHTML = '<div class="modern-no-results">Cargando productos populares...</div>';
        this.showDropdown();
    }
    
    async showTopSuggestions() {
        console.log('🌟 Loading top suggestions...');
        this.quickSuggestions.style.display = 'block';
        
        // Show dropdown immediately with placeholder content
        this.resultsContainer.innerHTML = '<div class="modern-loading">Cargando productos populares...</div>';
        this.showDropdown();
        
        try {
            // Load real top products from new API endpoint
            const response = await fetch('/api/top-suggestions');
            
            if (response.ok) {
                const data = await response.json();
                if (data && (data.products || data.brands || data.categories)) {
                    await this.displayRealTopSuggestions(data);
                    return;
                }
            }
            
            // Fallback: Load from popular searches
            const topQueries = ['parfem', 'lattafa', 'samsung', 'hodinky'];
            const allResults = [];
            
            for (let query of topQueries.slice(0, 2)) {
                try {
                    const response = await fetch(`/search9.php?whisper=1&t=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        allResults.push(...data.slice(0, 2));
                    }
                } catch (error) {
                    console.log('Error loading query:', query, error);
                }
            }
            
            if (allResults.length > 0) {
                this.displayTopSuggestions(allResults);
            } else {
                this.showNoTopSuggestions();
            }
        } catch (error) {
            console.error('Error loading top suggestions:', error);
            this.showNoTopSuggestions();
        }
    }
    
    displayTopSuggestions(results) {
        // Group results by type
        const products = results.filter(item => item.c === 1);
        const categories = results.filter(item => item.c === 2);
        const brands = results.filter(item => item.c === 3);
        
        let html = '';
        
        // Top products section - PRVNÍ
        if (products.length > 0) {
            html += '<div class="modern-section-header">🌟 Productos populares</div>';
            products.slice(0, 4).forEach(product => {
                const availability = product.s ? 'En stock' : 'Bajo pedido';
                const availabilityClass = product.s ? 'modern-product-availability' : 'modern-product-availability out-of-stock';
                
                html += `
                    <div class="modern-product-item" data-product-url="${product.u}">
                        <img src="${product.i}" alt="${this.stripHtml(product.n)}" class="modern-product-image" 
                             onerror="this.src='/img/placeholder/placeholder-m.webp'">
                        <div class="modern-product-info">
                            <div class="modern-product-name">${product.n}</div>
                            <div class="modern-product-price">${this.formatPrice(product.p)}</div>
                            <div class="${availabilityClass}">${availability}</div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Top categories section - DRUHÉ
        if (categories.length > 0) {
            html += '<div class="modern-section-header"><svg class="header-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.952,3.258,10.6,4.742a1,1,0,0,0,.67.258h4.616a1,1,0,0,1,1,1V7h-14V4a1,1,0,0,1,1-1h4.4A1,1,0,0,1,8.952,3.258ZM3,8H16.766a1,1,0,0,1,.993,1.11l-.777,7a1,1,0,0,1-.994.89H3.778a1,1,0,0,1-.994-.89l-.778-7A1,1,0,0,1,3,8Z" transform="translate(-2 -3)"></path></svg> Categorías populares</div>';
            categories.slice(0, 4).forEach(category => {
                html += `
                    <div class="modern-category-item" onclick="window.location='${category.u}'">
                        <div class="modern-category-icon">
                            <svg viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8.952,3.258,10.6,4.742a1,1,0,0,0,.67.258h4.616a1,1,0,0,1,1,1V7h-14V4a1,1,0,0,1,1-1h4.4A1,1,0,0,1,8.952,3.258ZM3,8H16.766a1,1,0,0,1,.993,1.11l-.777,7a1,1,0,0,1-.994.89H3.778a1,1,0,0,1-.994-.89l-.778-7A1,1,0,0,1,3,8Z" transform="translate(-2 -3)"></path>
                            </svg>
                        </div>
                        <div class="modern-category-name">${category.n}</div>
                    </div>
                `;
            });
        }
        
        // Top brands section - TŘETÍ
        if (brands.length > 0) {
            html += '<div class="modern-section-header">🏷️ Marcas populares</div>';
            html += '<div class="modern-brands-grid">';
            brands.slice(0, 6).forEach(brand => {
                html += `
                    <span class="modern-brand-item" onclick="window.location='${brand.u}'">${this.stripHtml(brand.n)}</span>
                `;
            });
            html += '</div>';
        }
        
        // No quick search tags - user doesn't want them
        
        this.quickSuggestions.style.display = 'none';
        this.resultsContainer.innerHTML = html;
        this.showDropdown();
        console.log('🌟 Top suggestions displayed');
    }
    
    async displayRealTopSuggestions(data) {
        console.log('🌟 Displaying real top suggestions:', data);
        
        // Check cart status for top products - ALWAYS get fresh data from server
        let cartStatus = {};
        if (data.products && data.products.length > 0) {
            const productIds = data.products.map(p => p.id || p.product_id).filter(Boolean);
            cartStatus = await this.checkCartStatus(productIds);
        }
        
        let html = '';
        
        // Top products section - PRVNÍ
        if (data.products && data.products.length > 0) {
            html += '<div class="modern-section-header">🌟 Productos populares</div>';
            data.products.forEach(product => {
                console.log('🛍️ Top product data:', product);
                const availability = product.s ? 'En stock' : 'Bajo pedido';
                const availabilityClass = product.s ? 'modern-product-availability' : 'modern-product-availability out-of-stock';
                
                // Check if product is in stock and has no variants (can add to cart)
                const canAddToCart = product.s && product.g !== 'y' && !product.v; // in stock, no garance, and no variants
                const productId = product.id || product.product_id; // extract product ID
                
                // Check if product is already in cart
                const inCart = cartStatus[productId]?.inCart || false;
                const cartQuantity = cartStatus[productId]?.quantity || 1;
                const cartRowId = cartStatus[productId]?.rowId || productId;
                
                console.log(`🛒 TOP SUGGESTION - Product ${productId}:`, {
                    inCart, 
                    cartQuantity, 
                    cartRowId,
                    cartStatus: cartStatus[productId],
                    willShowAddButton: !inCart && !product.v, // Don't show add button for products with variants
                    willShowQuantityControls: inCart
                });
                
                html += `
                    <div class="modern-product-item" data-product-url="${product.u}">
                        <img src="${product.i}" alt="${product.n}" class="modern-product-image" 
                             onerror="this.src='/img/placeholder/placeholder-m.webp'" 
                             onload="console.log('✅ Image loaded:', this.src)">
                        <div class="modern-product-info">
                            <div class="modern-product-name">${product.n}</div>
                            <div class="modern-product-bottom">
                                <div class="modern-product-left">
                                    <div class="modern-product-price">${this.formatPrice(product.p)}</div>
                                    <div class="${availabilityClass}">${availability}</div>
                                </div>
                                ${canAddToCart && productId ? `
                                    <div class="modern-product-right">
                                        <div class="modern-product-cart">
                                            ${!inCart ? `
                                                <button class="modern-add-to-cart-btn" data-product-id="${productId}" data-action="add-to-cart">
                                                    <i class="ci-cart me-1"></i>Añadir al carrito                                                </button>
                                            ` : ''}
                                            <div class="modern-quantity-controls ${inCart ? 'show' : ''}" id="qty-top-${productId}" data-row-id="${cartRowId}">
                                                <button class="modern-quantity-btn" data-product-id="${productId}" data-action="quantity-change" data-delta="-1">-</button>
                                                <span class="modern-quantity-display" id="qty-display-top-${productId}">${cartQuantity}</span>
                                                <button class="modern-quantity-btn" data-product-id="${productId}" data-action="quantity-change" data-delta="1">+</button>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Top categories section - DRUHÉ
        if (data.categories && data.categories.length > 0) {
            html += '<div class="modern-section-header"><svg class="header-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.952,3.258,10.6,4.742a1,1,0,0,0,.67.258h4.616a1,1,0,0,1,1,1V7h-14V4a1,1,0,0,1,1-1h4.4A1,1,0,0,1,8.952,3.258ZM3,8H16.766a1,1,0,0,1,.993,1.11l-.777,7a1,1,0,0,1-.994.89H3.778a1,1,0,0,1-.994-.89l-.778-7A1,1,0,0,1,3,8Z" transform="translate(-2 -3)"></path></svg> Categorías populares</div>';
            data.categories.forEach(category => {
                html += `
                    <div class="modern-category-item" onclick="window.location='${category.url}'">
                        <div class="modern-category-icon">
                            <svg viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8.952,3.258,10.6,4.742a1,1,0,0,0,.67.258h4.616a1,1,0,0,1,1,1V7h-14V4a1,1,0,0,1,1-1h4.4A1,1,0,0,1,8.952,3.258ZM3,8H16.766a1,1,0,0,1,.993,1.11l-.777,7a1,1,0,0,1-.994.89H3.778a1,1,0,0,1-.994-.89l-.778-7A1,1,0,0,1,3,8Z" transform="translate(-2 -3)"></path>
                            </svg>
                        </div>
                        <div class="modern-category-name">${category.name}</div>
                    </div>
                `;
            });
        }
        
        // Top brands section - TŘETÍ
        if (data.brands && data.brands.length > 0) {
            html += '<div class="modern-section-header">🏷️ Marcas populares</div>';
            html += '<div class="modern-brands-grid">';
            data.brands.forEach(brand => {
                html += `
                    <span class="modern-brand-item" onclick="window.location='${brand.url}'">${brand.name}</span>
                `;
            });
            html += '</div>';
        }
        
        // No quick search tags - user doesn't want them
        
        this.quickSuggestions.style.display = 'none';
        this.resultsContainer.innerHTML = html;
        this.showDropdown();
        console.log('🌟 Real top suggestions displayed');
    }
    
    showLoading() {
        this.quickSuggestions.style.display = 'none';
        this.resultsContainer.innerHTML = '<div class="modern-loading">Buscando...</div>';
        this.showDropdown();
    }
    
    showError() {
        this.resultsContainer.innerHTML = '<div class="modern-no-results"></div>';
    }
    
    showNoResults() {
        this.resultsContainer.innerHTML = '<div class="modern-no-results"></div>';
        this.showDropdown();
    }
    
    showDropdown() {
        console.log('📂 showDropdown called, isMobile:', this.isMobile);
        console.log('📂 Dropdown element:', this.dropdown);
        console.log('📂 Window width:', window.innerWidth);
        
        this.dropdown.classList.add('show');
        
        // Add active state to search wrapper
        this.searchInput.parentElement.classList.add('dropdown-active');
        
        if (this.isMobile) {
            console.log('📱 Mobile mode: setting body overflow hidden');
            console.log('📱 Dropdown should now be fullscreen');
            document.body.style.overflow = 'hidden';
            this.mobileSearch.value = this.searchInput.value;
            
            // For mobile, move dropdown to body for better fullscreen display
            if (this.dropdown.parentElement !== document.body) {
                console.log('📱 Moving dropdown to body for fullscreen');
                this.originalParent = this.dropdown.parentElement;
                this.originalNextSibling = this.dropdown.nextSibling;
                document.body.appendChild(this.dropdown);
                console.log('📱 Dropdown moved to body');
            }
            
            // Force mobile styles with maximum priority
            this.dropdown.style.display = 'block';
            this.dropdown.style.position = 'fixed';
            this.dropdown.style.top = '0';
            this.dropdown.style.left = '0';
            this.dropdown.style.right = '0';
            this.dropdown.style.bottom = '0';
            this.dropdown.style.width = '100vw';
            this.dropdown.style.height = '100vh';
            this.dropdown.style.zIndex = '99999';
            this.dropdown.style.background = 'white';
            this.dropdown.style.margin = '0';
            this.dropdown.style.borderRadius = '0';
            this.dropdown.style.maxHeight = '100vh';
            this.dropdown.style.overflowY = 'auto';
            
            console.log('📱 Forced mobile fullscreen styles applied');
            console.log('📱 Final dropdown styles:', {
                display: this.dropdown.style.display,
                position: this.dropdown.style.position,
                zIndex: this.dropdown.style.zIndex,
                width: this.dropdown.style.width,
                height: this.dropdown.style.height,
                background: this.dropdown.style.background,
                parent: this.dropdown.parentElement.tagName
            });
        } else {
            console.log('🖥️ Desktop mode');
        }
    }
    
    hideDropdown() {
        console.log('📱 hideDropdown() called - STACK TRACE:');
        console.trace('Who called hideDropdown?');
        
        this.dropdown.classList.remove('show');
        
        // Remove active state from search wrapper
        this.searchInput.parentElement.classList.remove('dropdown-active');
        
        if (this.isMobile) {
            document.body.style.overflow = '';
            
            // Move dropdown back to its original position
            if (this.originalParent && this.dropdown.parentElement === document.body) {
                console.log('📱 Moving dropdown back to original parent');
                if (this.originalNextSibling) {
                    this.originalParent.insertBefore(this.dropdown, this.originalNextSibling);
                } else {
                    this.originalParent.appendChild(this.dropdown);
                }
                console.log('📱 Dropdown moved back');
            }
        }
    }
    
    clearSearch() {
        this.searchInput.value = '';
        this.mobileSearch.value = '';
        this.currentQuery = '';
        this.clearBtn.style.display = 'none';
        this.showQuickSuggestions();
    }
    
    // Add product to cart functionality
    async addToCart(productId, buttonElement) {
        console.log('🛒 Adding to cart:', productId);
        
        try {
            buttonElement.disabled = true;
            buttonElement.innerHTML = '<span style="animation: blink 1s infinite;">...</span>';
            
            // Use /add_to_cart_direct/ endpoint which returns cart data
            const response = await fetch(`/add_to_cart_direct/${productId}`);
            
            if (response.ok) {
                const responseText = await response.text();
                // Parse response: "pieces|total|totalRaw"
                const result = responseText.split('|');
                const cartPieces = result[0];
                const cartTotal = result[1];
                
                // Update cart counters in header
                const cartPiecesEl = document.querySelector('#cart_pieces');
                if (cartPiecesEl) cartPiecesEl.textContent = cartPieces;
                
                // Update cart counters in sticky footer
                const cartPieces2El = document.querySelector('#cart_pieces2');
                if (cartPieces2El) cartPieces2El.textContent = cartPieces;
                
                // Show sticky footer badge if hidden
                const cartBadge2 = document.querySelector('#cart_badge2');
                if (cartBadge2) cartBadge2.style.display = '';
                
                // Update cart totals
                const cartTotalEl = document.querySelector('#cart_total');
                if (cartTotalEl) cartTotalEl.textContent = cartTotal;
                const cartTotal2El = document.querySelector('#cart_total2');
                if (cartTotal2El) cartTotal2El.textContent = cartTotal;
                const cartTotal3El = document.querySelector('#cart_total3');
                if (cartTotal3El) cartTotal3El.textContent = cartTotal;
                
                // Store product ID for quantity updates (we'll use product ID as fallback)
                let rowId = productId;
                buttonElement.dataset.rowId = rowId;
                
                // Show quantity controls instead of add button
                buttonElement.style.display = 'none';
                // Try to find quantity controls with different prefixes
                const quantityControls = document.getElementById(`qty-search-${productId}`) || 
                                        document.getElementById(`qty-top-${productId}`) || 
                                        document.getElementById(`qty-${productId}`);
                if (quantityControls) {
                    quantityControls.classList.add('show');
                    // Store row ID in controls too
                    quantityControls.dataset.rowId = rowId;
                    // Update quantity display to 1
                    const qtyDisplay = quantityControls.querySelector('.modern-quantity-display');
                    if (qtyDisplay) {
                        qtyDisplay.textContent = '1';
                    }
                }
                
                console.log('✅ Product added to cart successfully, pieces:', cartPieces, 'total:', cartTotal);
            } else {
                throw new Error('Failed to add to cart');
            }
            
        } catch (error) {
            console.error('❌ Error adding to cart:', error);
            buttonElement.innerHTML = '❌ Chyba';
            setTimeout(() => {
                buttonElement.disabled = false;
                buttonElement.innerHTML = 'Do košíku';
            }, 2000);
        }
    }
    
    // Change quantity in cart (like queueQtyUpdate from cart.php)
    async changeQuantity(productId, delta) {
        console.log('🔢 changeQuantity called:', productId, delta);
        console.log('🔢 Stack trace:', new Error().stack);
        
        // Simple debouncing - prevent very rapid clicks within 200ms only
        const now = Date.now();
        const debounceKey = `qty_${productId}`;
        
        if (!this.lastClickTime) this.lastClickTime = {};
        
        // Check if we clicked too recently (only very rapid clicks)
        if (this.lastClickTime[debounceKey] && (now - this.lastClickTime[debounceKey]) < 200) {
            console.log('🔢 Very rapid click, ignoring:', productId, 'time since last:', now - this.lastClickTime[debounceKey]);
            return;
        }
        
        this.lastClickTime[debounceKey] = now;
        
        // Find quantity display and controls with different prefixes
        const quantityDisplay = document.getElementById(`qty-display-search-${productId}`) || 
                               document.getElementById(`qty-display-top-${productId}`) || 
                               document.getElementById(`qty-display-${productId}`);
        const quantityControls = document.getElementById(`qty-search-${productId}`) || 
                               document.getElementById(`qty-top-${productId}`) || 
                               document.getElementById(`qty-${productId}`);
        if (!quantityDisplay || !quantityControls) {
            console.log('❌ Could not find quantity elements for product:', productId);
            return;
        }
        
        let currentQuantity = parseInt(quantityDisplay.textContent) || 1;
        const newQuantity = Math.max(1, currentQuantity + delta);
        
        if (newQuantity === currentQuantity) {
            return; // No change
        }
        
        // Get the stored row ID
        const rowId = quantityControls.dataset.rowId || productId;
        
        try {
            // Update display immediately for better UX
            quantityDisplay.textContent = newQuantity;
            
            // Send update to server using the cart row ID (same as cart.php queueQtyUpdate)
            const response = await fetch(`/cart_change/${newQuantity}/id/${rowId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest',
                },
                body: 'ajax=1'
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    // Update with server-confirmed quantity
                    quantityDisplay.textContent = data.qty || newQuantity;
                    
                    // Update cart totals if provided (like in cart.php)
                    if (data.orderTotalFmt) {
                        const cartTotals = document.querySelectorAll('#cart_total, #cart_total2, #cart_total3, .order-total, .msf-total-value');
                        cartTotals.forEach(el => el.textContent = data.orderTotalFmt);
                    }
                    
                    if (data.cartPieces) {
                        const cartPieces = document.querySelector('#cart_pieces');
                        if (cartPieces) cartPieces.textContent = data.cartPieces;
                        // Aktualizace sticky footeru
                        const cartPieces2 = document.querySelector('#cart_pieces2');
                        if (cartPieces2) cartPieces2.textContent = data.cartPieces;
                    }
                    
                    console.log('✅ Quantity updated successfully');
                } else {
                    throw new Error('Server returned error');
                }
            } else {
                throw new Error('Failed to update quantity');
            }
        } catch (error) {
            console.error('❌ Error updating quantity:', error);
            // Revert display on error
            quantityDisplay.textContent = currentQuantity;
        }
    }
    
    // Update cart counter in header and sticky footer
    updateCartCounter() {
        // Update cart counter if exists on page  
        const cartCounter = document.querySelector('.cart-counter, #cart-count, .basket-count, #cart_pieces');
        if (cartCounter) {
            // Simple approach - increment by 1 (for adding) or fetch actual count
            let currentCount = parseInt(cartCounter.textContent) || 0;
            cartCounter.textContent = currentCount + 1;
            
            if (currentCount >= 0) {
                cartCounter.style.display = 'inline';
            }
        }
        
        // Update sticky footer cart counter
        const cartCounter2 = document.querySelector('#cart_pieces2');
        if (cartCounter2) {
            let currentCount2 = parseInt(cartCounter2.textContent) || 0;
            cartCounter2.textContent = currentCount2 + 1;
        }
        
        // Show sticky footer badge if it was hidden
        const cartBadge2 = document.querySelector('#cart_badge2');
        if (cartBadge2) {
            cartBadge2.style.display = '';
        }
    }
    


    stripHtml(html) {
        const temp = document.createElement('div');
        temp.innerHTML = html;
        return temp.textContent || temp.innerText || '';
    }
}

// Global utility functions for compatibility
var getJSON = function(url, callback, abortSignal) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
        var status = xhr.status;
        if (status === 200) {
            callback(null, xhr.response);
        } else {
            callback(status, xhr.response);
        }
    };
    xhr.onerror = function() {
        callback(xhr.status, null);
    };
    if (abortSignal) {
        abortSignal.addEventListener('abort', () => {
            xhr.abort();
        });
    }
    xhr.send();
};

// Global cart functions for compatibility
function add_to_cart(product_id) {
    // Načteme qty z hidden pole nebo z listboxu, default 1
    var qty = $('#product_page_product_qty').val() || 1;
    qty = parseInt(qty);
    if(qty < 1 || qty > 10) qty = 1;
    
    send_to_cart("/add_to_cart_direct/" + product_id + "/" + qty);
}

function send_to_cart(url) {
    $.get(url, function(data) {
        var result = data.split('|');
        $('#cart_total').html(result[1]);
        $('#cart_total2').html(result[1]);
        $('#cart_total3').html(result[1]);
        $('#cart_pieces').html(result[0]);
        $('#cart_pieces2').html(result[0]);
        if (typeof updateShippingProgress === 'function') {
            updateShippingProgress(result[2]);
        }
        $('#modalLarge').modal('show');
    });
}

function add_to_cart_autocomplete(product_id) {
    $.get("/add_to_cart_direct/" + product_id, function(data) {
        var result = data.split('|');
        $('#cart_total').html(result[1]);
        $('#cart_total2').html(result[1]);
        $('#cart_total3').html(result[1]);
        $('#cart_pieces').html(result[0]);
        $('#cart_pieces2').html(result[0]);
        // Zobrazit badge ve sticky footeru pokud byl předtím skrytý
        if(parseInt(result[0]) > 0) {
            $('#cart_badge2').show();
        }
    });
}

function added(product_id) {
    var inserted = '&#x2713;';
    var obj = '#bp' + product_id;
    $(obj + ' span').html(inserted).removeClass('btn-success').addClass('btn-secondary').prop("onclick", null).off("click");
}

function close_ac(elmnt) {
    var x = document.getElementsByClassName("autocomplete-items");
    for (var i = 0; i < x.length; i++) {
        x[i].parentNode.removeChild(x[i]);
    }
}

// Escape key handler for autocomplete
$(document).ready(function() {
    $(document).on('keyup', function(e) {
        if (e.key == "Escape") close_ac();
    });
});
</script>


</body>
</html>
